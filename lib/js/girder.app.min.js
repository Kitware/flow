"use strict";if(this.jade=this.jade||{},this.jade.templates=this.jade.templates||{},this.jade.templates.adminConsole=function(){var a=[];return a.push('<ul class="g-admin-options"><li class="g-server-config"><i class="icon-cog-alt"></i> Server configuration</li><li class="g-plugins-config"><i class="icon-puzzle"></i> Plugins</li><li class="g-assetstore-config"><i class="icon-box-1"></i> Assetstores</li></ul>'),a.join("")},this.jade.templates.assetstores=function(a){var b,c=[],d=a||{},e=d.assetstores,f=d.undefined,g=d.types;return c.push('<div class="g-current-assetstores-container"><div class="g-body-title">Assetstores</div>'),c.push(e.length?'<div class="g-bottom-message">Below is a list of all of the assetstores available to the server. The\none set as "current" is the one that uploaded files will be written to.</div>':'<div class="g-bottom-message">You must create an assetstore before you can upload files to the server.\nSelect from the options below to create one.</div>'),function(){var a=e;if("number"==typeof a.length)for(var d=0,h=a.length;h>d;d++){var i=a[d];c.push("<div"+jade.cls(["g-assetstore-container","panel","panel-default",i.get("current")?"g-assetstore-current":f],[null,null,null,!0])+'><div class="panel-body"><div><b>Name:</b><span class="g-assetstore-name"> '+jade.escape(null==(b=i.get("name"))?"":b)+"</span>"),i.get("current")&&c.push('<span class="g-assetstore-current-text"> (Current assetstore)</span>'),c.push("</div>"),i.get("type")==g.FILESYSTEM?c.push('<div><b>Type:</b><span class="g-assetstore-type"> Filesystem</span></div><div><b>Root path:</b><span class="g-assetstore-root"> '+jade.escape(null==(b=i.get("root"))?"":b)+"</span></div>"):i.get("type")==g.GRIDFS?c.push('<div><b>Type:</b><span class="g-assetstore-type"> GridFS</span></div><div><b>Database name:</b><span class="g-assetstore-root"> '+jade.escape(null==(b=i.get("db"))?"":b)+"</span></div>"):i.get("type")==g.S3&&(c.push('<div><b>Type:</b><span class="g-assetstore-type"> S3</span></div><div><b>Bucket:</b><span class="g-assetstore-bucket"> '+jade.escape(null==(b=i.get("bucket"))?"":b)+"</span></div>"),i.get("prefix")&&c.push('<div><b>Path prefix:</b><span class="g-assetstore-prefix"> '+jade.escape(null==(b=i.get("prefix"))?"":b)+"</span></div>"),c.push('<div><b>Access key ID:</b><span class="g-access-key-id"> '+jade.escape(null==(b=i.get("accessKeyId"))?"":b)+'</span></div><div><b>Secret access key:</b><span class="g-secret-key"> '+jade.escape(null==(b=i.get("secret"))?"":b)+'</span></div><div><b>Service:</b><span class="g-service-key"> '+jade.escape(null==(b=i.get("service"))?"":b)+"</span></div>")),c.push('<div><b>Capacity:</b><span class="g-assetstore-capacity"> '+jade.escape(null==(b=i.capacityString())?"":b)+"</span></div>"),i.capacityKnown()&&c.push("<div"+jade.attr("cid",""+i.cid,!0,!1)+' class="g-assetstore-capacity-chart"></div>'),c.push('<div class="g-assetstore-buttons"><button'+jade.attr("cid",""+i.cid,!0,!1)+' class="g-edit-assetstore btn btn-sm btn-default">Edit</button>'),c.push(i.get("hasFiles")?'<div title="You must delete all files from the assetstore before you can delete the assetstore." class="g-assetstore-button-container"><button'+jade.attr("cid",""+i.cid,!0,!1)+' class="g-delete-assetstore btn btn-sm btn-danger disabled">Delete</button></div>':"<button"+jade.attr("cid",""+i.cid,!0,!1)+' class="g-delete-assetstore btn btn-sm btn-danger">Delete</button>'),i.get("current")||c.push("<button"+jade.attr("cid",""+i.cid,!0,!1)+' class="g-set-current btn btn-sm btn-primary">Set as current</button>'),c.push("</div></div></div>")}else{var h=0;for(var d in a){h++;var i=a[d];c.push("<div"+jade.cls(["g-assetstore-container","panel","panel-default",i.get("current")?"g-assetstore-current":f],[null,null,null,!0])+'><div class="panel-body"><div><b>Name:</b><span class="g-assetstore-name"> '+jade.escape(null==(b=i.get("name"))?"":b)+"</span>"),i.get("current")&&c.push('<span class="g-assetstore-current-text"> (Current assetstore)</span>'),c.push("</div>"),i.get("type")==g.FILESYSTEM?c.push('<div><b>Type:</b><span class="g-assetstore-type"> Filesystem</span></div><div><b>Root path:</b><span class="g-assetstore-root"> '+jade.escape(null==(b=i.get("root"))?"":b)+"</span></div>"):i.get("type")==g.GRIDFS?c.push('<div><b>Type:</b><span class="g-assetstore-type"> GridFS</span></div><div><b>Database name:</b><span class="g-assetstore-root"> '+jade.escape(null==(b=i.get("db"))?"":b)+"</span></div>"):i.get("type")==g.S3&&(c.push('<div><b>Type:</b><span class="g-assetstore-type"> S3</span></div><div><b>Bucket:</b><span class="g-assetstore-bucket"> '+jade.escape(null==(b=i.get("bucket"))?"":b)+"</span></div>"),i.get("prefix")&&c.push('<div><b>Path prefix:</b><span class="g-assetstore-prefix"> '+jade.escape(null==(b=i.get("prefix"))?"":b)+"</span></div>"),c.push('<div><b>Access key ID:</b><span class="g-access-key-id"> '+jade.escape(null==(b=i.get("accessKeyId"))?"":b)+'</span></div><div><b>Secret access key:</b><span class="g-secret-key"> '+jade.escape(null==(b=i.get("secret"))?"":b)+'</span></div><div><b>Service:</b><span class="g-service-key"> '+jade.escape(null==(b=i.get("service"))?"":b)+"</span></div>")),c.push('<div><b>Capacity:</b><span class="g-assetstore-capacity"> '+jade.escape(null==(b=i.capacityString())?"":b)+"</span></div>"),i.capacityKnown()&&c.push("<div"+jade.attr("cid",""+i.cid,!0,!1)+' class="g-assetstore-capacity-chart"></div>'),c.push('<div class="g-assetstore-buttons"><button'+jade.attr("cid",""+i.cid,!0,!1)+' class="g-edit-assetstore btn btn-sm btn-default">Edit</button>'),c.push(i.get("hasFiles")?'<div title="You must delete all files from the assetstore before you can delete the assetstore." class="g-assetstore-button-container"><button'+jade.attr("cid",""+i.cid,!0,!1)+' class="g-delete-assetstore btn btn-sm btn-danger disabled">Delete</button></div>':"<button"+jade.attr("cid",""+i.cid,!0,!1)+' class="g-delete-assetstore btn btn-sm btn-danger">Delete</button>'),i.get("current")||c.push("<button"+jade.attr("cid",""+i.cid,!0,!1)+' class="g-set-current btn btn-sm btn-primary">Set as current</button>'),c.push("</div></div></div>")}}}.call(this),c.push('</div><div id="g-new-assetstore-container"></div>'),c.join("")},this.jade.templates.collectionList=function(a){var b,c=[],d=a||{},e=d.girder,f=d.collections,g=d.undefined;return c.push('<div class="g-collection-list-header"><div class="g-collection-pagination"></div><form role="form" class="g-collection-search-form form-inline"><div class="form-group g-collections-search-container"></div></form>'),e.currentUser&&e.currentUser.get("admin")&&c.push('<button class="g-collection-create-button btn btn-sm btn-default"><i class="icon-plus-squared"></i> Create Collection</button>'),c.push("</div>"),function(){var a=f;if("number"==typeof a.length)for(var d=0,h=a.length;h>d;d++){var i=a[d];c.push('<div class="g-collection-list-entry"><div class="g-collection-right-column"><div class="g-collection-created"><i class="icon-clock"></i>Created on<span class="g-collection-created-date"> '+jade.escape(null==(b=e.formatDate(i.get("created"),e.DATE_MINUTE))?"":b)+"</span></div>"),i.get("size")!==g&&c.push('<div class="g-space-used"><i class="icon-floppy"></i>Currently using<span class="g-user-space-used"> '+jade.escape(null==(b=e.formatSize(i.get("size")))?"":b)+"</span></div>"),c.push('</div><div class="g-collection-title"><a'+jade.attr("g-collection-cid",""+i.cid,!0,!1)+' class="g-collection-link"><b>'+jade.escape(null==(b=i.get("name"))?"":b)+'</b></a></div><div class="g-collection-subtitle"><span class="g-collection-description"> '+jade.escape(null==(b=i.get("description"))?"":b)+'</span></div><div class="g-clear-right"></div></div>')}else{var h=0;for(var d in a){h++;var i=a[d];c.push('<div class="g-collection-list-entry"><div class="g-collection-right-column"><div class="g-collection-created"><i class="icon-clock"></i>Created on<span class="g-collection-created-date"> '+jade.escape(null==(b=e.formatDate(i.get("created"),e.DATE_MINUTE))?"":b)+"</span></div>"),i.get("size")!==g&&c.push('<div class="g-space-used"><i class="icon-floppy"></i>Currently using<span class="g-user-space-used"> '+jade.escape(null==(b=e.formatSize(i.get("size")))?"":b)+"</span></div>"),c.push('</div><div class="g-collection-title"><a'+jade.attr("g-collection-cid",""+i.cid,!0,!1)+' class="g-collection-link"><b>'+jade.escape(null==(b=i.get("name"))?"":b)+'</b></a></div><div class="g-collection-subtitle"><span class="g-collection-description"> '+jade.escape(null==(b=i.get("description"))?"":b)+'</span></div><div class="g-clear-right"></div></div>')}}}.call(this),c.join("")},this.jade.templates.collectionPage=function(a){var b,c=[],d=a||{},e=d.collection,f=d.girder;return c.push('<div class="g-collection-header"><div class="btn-group pull-right"><button data-toggle="dropdown" title="Collection actions" class="g-collection-actions-button btn btn-default dropdown-toggle"><i class="icon-sitemap"></i> Actions<i class="icon-down-dir"></i></button><ul role="menu" class="g-collection-actions-menu dropdown-menu pull-right"><li role="presentation"><a role="menuitem" class="g-download-collection"><i class="icon-download"></i>Download collection</a></li>'),e.getAccessLevel()>=f.AccessType.WRITE&&c.push('<li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" class="g-edit-collection"><i class="icon-edit"></i>Edit collection</a></li>'),e.getAccessLevel()>=f.AccessType.ADMIN&&c.push('<li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" class="g-collection-access-control"><i class="icon-lock"></i>Access control</a></li><li role="presentation"><a role="menuitem" class="g-delete-collection"><i class="icon-trash"></i>Delete collection</a></li>'),c.push('</ul></div><div class="g-collection-name g-body-title">'+jade.escape(null==(b=e.get("name"))?"":b)+'</div><div class="g-collection-description g-body-subtitle">'+jade.escape(null==(b=e.get("description"))?"":b)+'</div><div class="g-clear-right"></div></div><div class="g-collection-hierarchy-container"></div>'),c.join("")},this.jade.templates.frontPage=function(a){var b,c=[],d=a||{},e=d.staticRoot,f=d.apiRoot,g=d.currentUser,h=d.versionInfo;return c.push('<div class="g-frontpage-header"><img'+jade.attr("src",""+e+"/img/Girder_Mark.png",!0,!1)+' width="82" class="g-frontpage-logo"/><div class="g-frontpage-title-container"><div class="g-frontpage-title">Girder</div><div class="g-frontpage-subtitle">High performance data management</div></div></div><div class="g-frontpage-body"><p class="g-frontpage-paragraph"><b>Welcome to Girder!</b> If this is your first time here, you might want to check out the<a target="_blank" href="http://girder.readthedocs.org/en/latest/user-guide.html"> User Guide</a> to learn the basics of how to use the application.\n To browse the data hosted on this server, start on the<a class="g-collections-link"> Collections</a> page. If you want to search for specific data on this server, use the<a class="g-quicksearch-link"> Quick Search</a> box at the top of the screen. Developers who want to use the Girder REST API\n should check out the<a'+jade.attr("href",""+f,!0,!1)+"> interactive web API docs</a>."),c.push(g?'<p class="g-frontpage-paragraph"> You are currently logged in as<b> '+jade.escape(null==(b=g.get("login"))?"":b)+'</b>. You can view your<a class="g-my-folders-link"> personal data space</a> or go to your<a class="g-my-account-link"> user account page.</a></p>':'<p class="g-frontpage-paragraph"> You are currently browsing anonymously. If you want to create a user\n account on this server, click the<a class="g-register-link"> Register</a> link in the upper right corner. If you already have a user, click the<a class="g-login-link"> Log In</a> link. Otherwise, you will only be able to see publicly visible data\n in the system.</p>'),c.push(h.git?'<p class="g-frontpage-paragraph">This instance of girder was built from git version <a target="_blank"'+jade.attr("href","https://github.com/girder/girder/tree/"+h.SHA,!0,!1)+' class="g-git-sha">'+jade.escape(null==(b=h.shortSHA)?"":b)+"</a>.</p>":'<p class="g-frontpage-paragraph">This instance of girder was built on '+jade.escape(null==(b=new Date(h.date).toLocaleDateString())?"":b)+".</p>"),c.push("</p></div>"),c.join("")},this.jade.templates.groupList=function(a){var b,c=[],d=a||{},e=d.girder,f=d.groups;return c.push('<div class="g-groups-list-header"><div class="g-group-pagination"></div><form role="form" class="g-group-search-form form-inline"><div class="form-group g-groups-search-container"></div></form>'),e.currentUser&&e.currentUser.get("admin")&&c.push('<button class="g-group-create-button btn btn-sm btn-default"><i class="icon-plus-squared"></i> Create Group</button>'),c.push("</div>"),function(){var a=f;if("number"==typeof a.length)for(var d=0,g=a.length;g>d;d++){var h=a[d];c.push('<div class="g-group-list-entry"><div class="g-group-right-column"><div class="g-group-created"><i class="icon-clock"></i>Created on<span class="g-group-created-date"> '+jade.escape(null==(b=e.formatDate(h.get("created"),e.DATE_DAY))?"":b)+'</span></div><div class="g-group-privacy">'),c.push(h.get("public")?'<i class="icon-globe"></i>Public group':'<i class="icon-lock"></i>Private group'),c.push('</div></div><div class="g-group-title"><a'+jade.attr("g-group-cid",""+h.cid,!0,!1)+' class="g-group-link"><b>'+jade.escape(null==(b=h.get("name"))?"":b)+'</b></a></div><div class="g-group-subtitle"><span class="g-group-description"> '+jade.escape(null==(b=h.get("description"))?"":b)+'</span></div><div class="g-clear-right"></div></div>')}else{var g=0;for(var d in a){g++;var h=a[d];c.push('<div class="g-group-list-entry"><div class="g-group-right-column"><div class="g-group-created"><i class="icon-clock"></i>Created on<span class="g-group-created-date"> '+jade.escape(null==(b=e.formatDate(h.get("created"),e.DATE_DAY))?"":b)+'</span></div><div class="g-group-privacy">'),c.push(h.get("public")?'<i class="icon-globe"></i>Public group':'<i class="icon-lock"></i>Private group'),c.push('</div></div><div class="g-group-title"><a'+jade.attr("g-group-cid",""+h.cid,!0,!1)+' class="g-group-link"><b>'+jade.escape(null==(b=h.get("name"))?"":b)+'</b></a></div><div class="g-group-subtitle"><span class="g-group-description"> '+jade.escape(null==(b=h.get("description"))?"":b)+'</span></div><div class="g-clear-right"></div></div>')}}}.call(this),c.join("")},this.jade.templates.groupPage=function(a){var b,c=[],d=a||{},e=d.isMember,f=d.isInvited,g=d.girder,h=d.group,i=d.isRequested;return c.push('<div class="g-group-header"><div class="btn-group pull-right"><button data-toggle="dropdown" title="Group actions" class="g-group-actions-button btn btn-default dropdown-toggle"><i class="icon-users"></i> Actions<i class="icon-down-dir"></i></button><ul role="menu" class="g-group-actions-menu dropdown-menu pull-right">'),e?c.push('<li role="presentation"><a role="menuitem" class="g-group-leave"><i class="icon-block"></i>Leave group</a></li>'):f?c.push('<li role="presentation"><a role="menuitem" class="g-group-join"><i class="icon-login"></i>Join group</a></li>'):g.currentUser&&c.push('<li role="presentation"><a role="menuitem" class="g-group-request-invite"><i class="icon-export"></i>Request membership</a></li>'),h.get("_accessLevel")>=g.AccessType.WRITE&&c.push('<li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" class="g-edit-group"><i class="icon-edit"></i>Edit group</a></li>'),h.get("_accessLevel")>=g.AccessType.ADMIN&&c.push('<li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" class="g-group-delete"><i class="icon-trash"></i>Delete group</a></li>'),c.push('</ul></div><div class="g-group-name g-body-title">'+jade.escape(null==(b=h.get("name"))?"":b)+'</div><div class="g-group-description g-body-subtitle">'+jade.escape(null==(b=h.get("description"))?"":b)+'</div><div class="g-clear-right"></div></div>'),g.currentUser&&(e?(c.push('<div class="g-group-status-container g-member"><i class="icon-ok"></i>'),c.push(h.get("_accessLevel")<g.AccessType.WRITE?" You are a <b>member</b> of this group.":h.get("_accessLevel")<g.AccessType.ADMIN?" You are a <b>moderator</b> of this group.":" You are an <b>administrator</b> of this group."),c.push("</div>")):c.push(f?'<div class="g-group-status-container g-invited"><i class="icon-mail-alt"></i> You have been invited to this group.<a class="g-group-join"> Join group</a></div>':i?'<div class="g-group-status-container g-requested-invite"><i class="icon-comment"></i> You have requested to join this group.</div>':'<div class="g-group-status-container g-nonmember"><i class="icon-minus-circled"></i> You are not a member of this group.<a class="g-group-request-invite"> Request membership</a></div>')),c.push('<ul class="g-group-tabs nav nav-tabs"><li class="active"><a href="#g-group-tab-roles" data-toggle="tab" name="roles"><i class="icon-th-list"></i> Roles</a></li><li><a href="#g-group-tab-pending" data-toggle="tab" name="pending"><i class="icon-inbox"></i>Pending</a></li></ul><div class="tab-content"><div id="g-group-tab-roles" class="tab-pane active"><div class="g-group-members-container"></div><div class="g-group-mods-container"></div><div class="g-group-admins-container"></div></div><div id="g-group-tab-pending" class="tab-pane"><div class="g-group-requests-container"><div class="g-group-requests-header g-group-list-header"><i class="icon-comment"></i> Requests for membership</div><div class="g-group-requests-body"><ul class="g-group-requests">'),function(){var a=h.get("requests");if("number"==typeof a.length)for(var d=0,e=a.length;e>d;d++){var f=a[d];c.push("<li"+jade.attr("userid",""+f.id,!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=f.name)?"":b)+" ("+jade.escape(null==(b=f.login)?"":b)+')</a><div class="g-group-member-controls pull-right">'),h.get("_accessLevel")>=g.AccessType.WRITE&&c.push('<a title="Add to group" class="g-group-request-accept"><i class="icon-thumbs-up"></i></a><a title="Deny request" class="g-group-request-deny"><i class="icon-thumbs-down"></i></a>'),c.push("</div></li>")}else{var e=0;for(var d in a){e++;var f=a[d];c.push("<li"+jade.attr("userid",""+f.id,!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=f.name)?"":b)+" ("+jade.escape(null==(b=f.login)?"":b)+')</a><div class="g-group-member-controls pull-right">'),h.get("_accessLevel")>=g.AccessType.WRITE&&c.push('<a title="Add to group" class="g-group-request-accept"><i class="icon-thumbs-up"></i></a><a title="Deny request" class="g-group-request-deny"><i class="icon-thumbs-down"></i></a>'),c.push("</div></li>")}}}.call(this),h.get("requests").length||c.push('<div class="g-member-list-empty"><i class="icon-info-circled"></i> There are no outstanding invitation requests for this group.</div>'),c.push('</ul></div></div><div class="g-group-invites-container"><div class="g-group-invites-header g-group-list-header"><i class="icon-mail-alt"></i> Sent invitations</div><div class="g-group-invites-body"></div></div></div></div>'),c.join("")},this.jade.templates.itemPage=function(a){var b,c=[],d=a||{},e=d.accessLevel,f=d.girder,g=d.item;return c.push('<div class="g-item-breadcrumb-container"></div><div class="g-item-header"><div class="btn-group pull-right"><button data-toggle="dropdown" title="Item actions" class="g-item-actions-button btn btn-default dropdown-toggle"><i class="icon-sitemap"></i> Actions<i class="icon-down-dir"></i></button><ul role="menu" class="g-item-actions-menu dropdown-menu pull-right"><li role="presentation"><a role="menuitem" class="g-download-item"><i class="icon-download"></i>Download item</a></li>'),e>=f.AccessType.WRITE&&c.push('<li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" class="g-edit-item"><i class="icon-edit"></i>Edit item</a></li>'),e>=f.AccessType.WRITE&&c.push('<li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" class="g-delete-item"><i class="icon-trash"></i>Delete item</a></li>'),c.push('</ul></div><div class="g-item-name g-body-title">'+jade.escape(null==(b=g.get("name"))?"":b)+'</div><div class="g-item-description g-body-subtitle">'+jade.escape(null==(b=g.get("description"))?"":b)+'</div></div><div class="g-item-info"><div class="g-item-info-header"><i class="icon-info"></i>Info</div><div class="g-item-size g-info-list-entry"><i class="icon-hdd"></i>'+jade.escape(null==(b=f.formatSize(g.get("size")))?"":b)+" ("+jade.escape(null==(b=g.get("size"))?"":b)+' bytes)</div><div class="g-item-created g-info-list-entry"><i class="icon-clock"></i>Created on '+jade.escape(null==(b=f.formatDate(g.get("created"),f.DATE_SECOND))?"":b)+'</div><div class="g-item-updated g-info-list-entry"><i class="icon-clock"></i>Updated on '+jade.escape(null==(b=f.formatDate(g.get("updated"),f.DATE_SECOND))?"":b)+'</div></div><div class="g-item-metadata"></div><div class="g-item-files"><div class="g-item-files-header"><i class="icon-docs"></i> Files &amp; links</div><div class="g-item-files-container"></div></div>'),c.join("")},this.jade.templates.plugins=function(a){var b,c=[],d=a||{},e=d.allPlugins,f=d.undefined;return c.push('<div class="g-body-title">Plugins</div><div class="g-plugin-list-container">'),function(){var a=e;if("number"==typeof a.length)for(var d=0,g=a.length;g>d;d++){var h=a[d];c.push('<div class="g-plugin-list-item"><input type="checkbox"'+jade.attr("key",""+d,!0,!1)+jade.attr("checked",h.enabled?"checked":f,!0,!1)+' class="g-plugin-switch"/><div class="g-plugin-name">'+jade.escape(null==(b=h.name)?"":b)),h.configRoute&&c.push("<a"+jade.attr("g-route",""+h.configRoute,!0,!1)+' title="Configure Plugin" class="g-plugin-config-link"><i class="icon-cog"></i></a>'),c.push('</div><div class="g-plugin-description">'+jade.escape(null==(b=h.description)?"":b)+"</div></div>")}else{var g=0;for(var d in a){g++;var h=a[d];c.push('<div class="g-plugin-list-item"><input type="checkbox"'+jade.attr("key",""+d,!0,!1)+jade.attr("checked",h.enabled?"checked":f,!0,!1)+' class="g-plugin-switch"/><div class="g-plugin-name">'+jade.escape(null==(b=h.name)?"":b)),h.configRoute&&c.push("<a"+jade.attr("g-route",""+h.configRoute,!0,!1)+' title="Configure Plugin" class="g-plugin-config-link"><i class="icon-cog"></i></a>'),c.push('</div><div class="g-plugin-description">'+jade.escape(null==(b=h.description)?"":b)+"</div></div>")}}}.call(this),c.push("</div>"),c.join("")},this.jade.templates.systemConfiguration=function(a){var b=[],c=a||{},d=c.settings,e=c.defaults;return b.push('<div class="g-body-title">System configuration</div><form role="form" class="g-settings-form"><div class="form-group"><label for="g-core-cookie-lifetime">Cookie duration (days)</label><input id="g-core-cookie-lifetime" type="text"'+jade.attr("value",""+(d["core.cookie_lifetime"]||""),!0,!1)+jade.attr("placeholder","Default: "+(e["core.cookie_lifetime"]||""),!0,!1)+' title="How long users will stay logged in." class="form-control input-sm"/></div><div class="form-group"><label for="g-core-smtp-host">SMTP host</label><input id="g-core-smtp-host" type="text"'+jade.attr("value",""+(d["core.smtp_host"]||""),!0,!1)+jade.attr("placeholder","Default: "+(e["core.smtp_host"]||""),!0,!1)+' title="The address of the SMTP server used to send emails." class="form-control input-sm"/></div><div class="form-group"><label for="g-core-email-from-address">Email from address</label><input id="g-core-email-from-address" type="text"'+jade.attr("value",""+(d["core.email_from_address"]||""),!0,!1)+jade.attr("placeholder","Default: "+(e["core.email_from_address"]||""),!0,!1)+' title="The email address the system will use when sending emails." class="form-control input-sm"/></div><div class="form-group"><label for="g-core-registration-policy">Registration policy</label><select id="g-core-registration-policy" class="form-control input-sm"><option value="open">Open registration</option><option value="closed">Closed registration</option></select></div><div id="g-configuration-accordion" class="panel-group"><div class="panel panel-default"><div class="panel-heading"><div class="panel-title"><a data-toggle="collapse" data-parent="#g-configuration-accordion" href="#g-advanced-settings-tab"><b>Advanced Settings</b></a></div></div><div id="g-advanced-settings-tab" class="panel-collapse collapse"><div class="panel-body"><p>These settings should only be changed if you are certain of what\n you are doing.</p><div class="form-group"><label for="g-core-upload-minimum-chunk-size">Upload minimum chunk size (bytes)</label><br/>This applies to Filesystem and GridFS assetstores.<input id="g-core-upload-minimum-chunk-size" type="text"'+jade.attr("value",""+(d["core.upload_minimum_chunk_size"]||""),!0,!1)+jade.attr("placeholder","Default: "+(e["core.upload_minimum_chunk_size"]||""),!0,!1)+' title="For large files, the minimum size of all but the last chunk." class="form-control input-sm"/></div></div></div></div></div><p></p><div class="form-group"><button class="g-submit-settings btn btn-default btn-sm"><i class="icon-ok"></i> Save</button></div><div id="g-settings-error-message" class="g-validation-failed-message"></div></form>'),b.join("")},this.jade.templates.userList=function(a){var b,c=[],d=a||{},e=d.users,f=d.girder,g=d.undefined;return c.push('<div class="g-user-list-header"><div class="g-user-pagination"></div><form role="form" class="g-user-search-form form-inline"><div class="form-group g-users-search-container"></div></form></div>'),function(){var a=e;if("number"==typeof a.length)for(var d=0,h=a.length;h>d;d++){var i=a[d];c.push('<div class="g-user-list-entry"><div class="g-user-right-column"><div class="g-user-joined"><i class="icon-clock"></i>Joined on<span class="g-user-joined-date"> '+jade.escape(null==(b=f.formatDate(i.get("created"),f.DATE_DAY))?"":b)+"</span></div>"),i.get("size")!==g&&c.push('<div class="g-space-used"><i class="icon-floppy"></i>Currently using<span class="g-user-space-used"> '+jade.escape(null==(b=f.formatSize(i.get("size")))?"":b)+"</span></div>"),c.push('</div><div class="g-user-title"><a'+jade.attr("g-user-cid",""+i.cid,!0,!1)+' class="g-user-link"><b>'+jade.escape(null==(b=i.get("firstName"))?"":b)+" "+jade.escape(null==(b=i.get("lastName"))?"":b)+'</b></a></div><div class="g-user-subtitle"><span class="g-user-login"> '+jade.escape(null==(b=i.get("login"))?"":b)+'</span></div><div class="g-clear-right"></div></div>')}else{var h=0;for(var d in a){h++;var i=a[d];c.push('<div class="g-user-list-entry"><div class="g-user-right-column"><div class="g-user-joined"><i class="icon-clock"></i>Joined on<span class="g-user-joined-date"> '+jade.escape(null==(b=f.formatDate(i.get("created"),f.DATE_DAY))?"":b)+"</span></div>"),i.get("size")!==g&&c.push('<div class="g-space-used"><i class="icon-floppy"></i>Currently using<span class="g-user-space-used"> '+jade.escape(null==(b=f.formatSize(i.get("size")))?"":b)+"</span></div>"),c.push('</div><div class="g-user-title"><a'+jade.attr("g-user-cid",""+i.cid,!0,!1)+' class="g-user-link"><b>'+jade.escape(null==(b=i.get("firstName"))?"":b)+" "+jade.escape(null==(b=i.get("lastName"))?"":b)+'</b></a></div><div class="g-user-subtitle"><span class="g-user-login"> '+jade.escape(null==(b=i.get("login"))?"":b)+'</span></div><div class="g-clear-right"></div></div>')}}}.call(this),c.join("")},this.jade.templates.userPage=function(a){var b,c=[],d=a||{},e=d.user,f=d.girder;return c.push('<div class="g-user-header">'),e.getAccessLevel()>=f.AccessType.WRITE&&(c.push('<div class="btn-group pull-right"><button data-toggle="dropdown" title="Item actions" class="g-user-actions-button btn btn-default dropdown-toggle"><i class="icon-user"></i> Actions<i class="icon-down-dir"></i></button><ul role="menu" class="g-item-actions-menu dropdown-menu pull-right"><li role="presentation"><a role="menuitem" class="g-edit-user"><i class="icon-edit"></i>Edit user</a></li>'),e.getAccessLevel()>=f.AccessType.ADMIN&&c.push('<li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" class="g-delete-user"><i class="icon-trash"></i>Delete user</a></li>'),c.push("</ul></div>")),c.push('<div class="g-user-name g-body-title">'+jade.escape(null==(b=e.get("firstName"))?"":b)+" "+jade.escape(null==(b=e.get("lastName"))?"":b)+'</div><div class="g-user-login g-body-subtitle">'+jade.escape(null==(b=e.get("login"))?"":b)+'</div></div><div class="g-user-hierarchy-container"></div>'),c.join("")},this.jade.templates.userSettings=function(a){var b,c=[],d=a||{},e=d.user,f=d.girder;return c.push('<div class="g-account-header"><div class="g-user-name g-body-title">'+jade.escape(null==(b=e.name())?"":b)+'</div><div class="g-user-description g-body-subtitle">'+jade.escape(null==(b=e.get("login"))?"":b)+'</div></div><ul class="g-account-tabs nav nav-tabs"><li class="active"><a href="#g-account-tab-info" data-toggle="tab" name="info"><i class="icon-info-circled"></i> Profile</a></li><li><a href="#g-account-tab-password" data-toggle="tab" name="password"><i class="icon-lock"></i>Password</a></li></ul><div class="tab-content"><div id="g-account-tab-info" class="tab-pane active"><div class="g-user-info-container"><form id="g-user-info-form" role="form"><div class="form-group"><label for="g-login">Login</label><p class="form-control-static">'+jade.escape(null==(b=e.get("login"))?"":b)+'</p></div><div class="form-group"><label for="g-email">Email</label><input id="g-email" type="text"'+jade.attr("value",""+e.get("email"),!0,!1)+' class="input-sm form-control"/></div><div class="form-group"><label for="g-firstName">First name</label><input id="g-firstName" type="text"'+jade.attr("value",""+e.get("firstName"),!0,!1)+' class="input-sm form-control"/></div><div class="form-group"><label for="g-lastName">Last name</label><input id="g-lastName" type="text"'+jade.attr("value",""+e.get("lastName"),!0,!1)+' class="input-sm form-control"/></div>'),f.currentUser.get("admin")&&(c.push('<div class="form-group"><label for="g-admin">User is site admin</label>'),c.push(e.get("admin")?'<input id="g-admin" type="checkbox" checked="checked" class="input-sm-form-control"/>':'<input id="g-admin" type="checkbox" class="input-sm-form-control"/>'),c.push("</div>")),c.push('<button type="submit" class="btn btn-default btn-sm"><i class="icon-edit"></i>Save</button><div id="g-user-info-error-msg" class="g-validation-failed-message"></div></form></div></div><div id="g-account-tab-password" class="tab-pane"><div class="g-password-change-container"><form id="g-password-change-form" role="form"><div class="form-group"><label for="g-password-old">Current password</label><input id="g-password-old" type="password" placeholder="Enter current password" class="input-sm form-control"/></div><div class="form-group"><label for="g-password-new">New password</label><input id="g-password-new" type="password" placeholder="Enter new password" class="input-sm form-control"/></div><div class="form-group"><label for="g-password-retype">Retype new password</label><input id="g-password-retype" type="password" placeholder="Retype new password" class="input-sm form-control"/></div><button type="submit" class="btn btn-default btn-sm"><i class="icon-lock"></i>Change</button><div id="g-password-change-error-msg" class="g-validation-failed-message"></div></form></div></div></div>'),c.join("")},this.jade.templates.alert=function(a){var b,c=[],d=a||{},e=d.type,f=d.icon,g=d.text;return c.push("<div"+jade.cls(["alert","alert-dismissable","alert-"+e],[null,null,!0])+'><button type="button" data-dismiss="alert" aria-hidden="true" class="close">&times;</button>'),f&&c.push("<i"+jade.cls(["icon-"+f],[!0])+"></i>"),c.push(" "+jade.escape(null==(b=g)?"":b)+"</div>"),c.join("")},this.jade.templates.layout=function(){var a=[];return a.push('<div id="g-app-header-container"></div><div id="g-global-nav-container"></div><div id="g-app-body-container"></div><div id="g-app-footer-container"></div><div id="g-app-progress-container"></div><div id="g-dialog-container" class="modal fade"></div><div id="g-alerts-container"></div>'),a.join("")
},this.jade.templates.layoutFooter=function(a){var b=[],c=a||{},d=c.apiRoot;return b.push('<div class="g-footer-links"><a id="g-about-link" href="http://girder.readthedocs.org/en/latest/user-guide.html">About</a><a id="g-contact-link" href="mailto:kitware@kitware.com">Contact</a><a'+jade.attr("href",""+d,!0,!1)+'>Web API</a><a id="g-bug-link" href="https://github.com/girder/girder/issues/new">Report a bug</a></div><div class="g-footer-info">&copy; Kitware, Inc.</div>'),b.join("")},this.jade.templates.layoutGlobalNav=function(a){var b,c=[],d=a||{},e=d.navItems;return c.push('<div class="g-global-nav-main"><ul class="g-global-nav">'),function(){var a=e;if("number"==typeof a.length)for(var d=0,f=a.length;f>d;d++){var g=a[d];c.push('<li class="g-global-nav-li"><a'+jade.attr("g-target",""+g.target,!0,!1)+jade.attr("g-name",""+g.name,!0,!1)+' class="g-nav-link"><i'+jade.cls([""+g.icon],[!0])+"></i><span>"+jade.escape(null==(b=g.name)?"":b)+"</span></a></li>")}else{var f=0;for(var d in a){f++;var g=a[d];c.push('<li class="g-global-nav-li"><a'+jade.attr("g-target",""+g.target,!0,!1)+jade.attr("g-name",""+g.name,!0,!1)+' class="g-nav-link"><i'+jade.cls([""+g.icon],[!0])+"></i><span>"+jade.escape(null==(b=g.name)?"":b)+"</span></a></li>")}}}.call(this),c.push('</ul></div><div class="g-global-nav-fade"></div>'),c.join("")},this.jade.templates.layoutHeader=function(){var a=[];return a.push('<div class="g-header-wrapper"><div class="g-app-title">Girder</div><form role="form" class="g-quick-search-form form-inline"><div class="form-group g-quick-search-container"></div></form><div class="g-current-user-wrapper navbar-right"></div><div class="g-clear-both"></div></div>'),a.join("")},this.jade.templates.layoutHeaderUser=function(a){var b,c=[],d=a||{},e=d.user;return c.push('<div class="g-user-text">'),c.push(e?'<a data-toggle="dropdown" data-target="#g-user-action-menu">'+jade.escape(null==(b=e.get("firstName"))?"":b)+" "+jade.escape(null==(b=e.get("lastName"))?"":b)+'<i class="icon-down-open"></i></a><div id="g-user-action-menu" class="dropdown"><ul role="menu" class="dropdown-menu"><li role="presentation"><a class="g-my-folders"><i class="icon-folder"></i>My folders</a></li><li role="presentation"><a class="g-my-settings"><i class="icon-cog"></i>My account</a></li><li role="presentation" class="divider"></li><li role="presentation"><a class="g-logout"><i class="icon-logout"></i>Log out</a></li></ul></div>':'<a class="g-register">Register</a> or<a class="g-login"> Log In<i class="icon-login"></i></a>'),c.push("</div>"),c.join("")},this.jade.templates.layoutProgressArea=function(){var a=[];return a.push('<div class="g-progress-list-container"></div>'),a.join("")},this.jade.templates.loginDialog=function(){var a=[];return a.push('<div class="modal-dialog"><div class="modal-content"><form id="g-login-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">Log in</h4></div><div class="modal-body"><div class="form-group"><label for="g-login" class="control-label">Login or email</label><input id="g-login" type="text" placeholder="Enter login" class="input-sm form-control"/></div><div class="form-group"><label for="g-password" class="control-label">Password</label><input id="g-password" type="password" placeholder="Enter password" class="input-sm form-control"/></div><div class="g-validation-failed-message"></div><div class="g-bottom-message">Don\'t have an account yet?<a class="g-register-link"> Register here.</a> |<a class="g-forgot-password"> Forgot your password?</a></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-default">Close</a><button id="g-login-button" type="submit" class="btn btn-primary"><i class="icon-login"></i> Login</button></div></form></div></div>'),a.join("")},this.jade.templates.registerDialog=function(){var a=[];return a.push('<div class="modal-dialog"><div class="modal-content"><form id="g-register-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">Sign up</h4></div><div class="modal-body"><div id="g-group-login" class="form-group"><label for="g-login" class="control-label">Choose a login name</label><input id="g-login" type="text" placeholder="Login" class="input-sm form-control"/></div><div id="g-group-email" class="form-group"><label for="g-email" class="control-label">Enter your email address</label><input id="g-email" type="text" placeholder="Email" class="input-sm form-control"/></div><div id="g-group-firstName" class="form-group"><label for="g-firstName" class="control-label">Enter your first name</label><input id="g-firstName" type="text" placeholder="First Name" class="input-sm form-control"/></div><div id="g-group-lastName" class="form-group"><label for="g-lastName" class="control-label">Enter your last name</label><input id="g-lastName" type="text" placeholder="Last Name" class="input-sm form-control"/></div><div id="g-group-password" class="form-group"><label for="g-password" class="control-label">Choose a password</label><input id="g-password" type="password" placeholder="Password" class="input-sm form-control"/></div><div id="g-group-password2" class="form-group"><label for="g-password2" class="control-label">Retype your password</label><input id="g-password2" type="password" placeholder="Password" class="input-sm form-control"/></div><div class="g-validation-failed-message"></div><div class="g-bottom-message">Already have an account?<a class="g-login-link"> Log in here.</a></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-default">Close</a><button id="g-register-button" type="submit" class="btn btn-primary"><i class="icon-plus-circled"></i> Register</button></div></form></div></div>'),a.join("")},this.jade.templates.resetPasswordDialog=function(){var a=[];return a.push('<div class="modal-dialog"><div class="modal-content"><form id="g-reset-password-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">Reset password</h4></div><div class="modal-body"><div class="g-password-reset-explanation">If you have forgotten your password, you can enter your email address\nhere. Your password will be reset and an email will be sent to that\naddress with the new password.</div><div class="form-group"><label for="g-email" class="control-label">Email</label><input id="g-email" type="text" placeholder="Enter your email" class="input-sm form-control"/></div><div class="g-validation-failed-message"></div><div class="g-bottom-message"><a class="g-register-link"> Register</a> |<a class="g-login-link"> Login</a></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-default">Close</a><button id="g-reset-password-button" type="submit" class="btn btn-primary"><i class="icon-mail"></i> Reset</button></div></form></div></div>'),a.join("")},this.jade.templates.accessEditor=function(a){var b,c=[],d=a||{},e=d.modelType,f=d.model,g=d.public,h=d.undefined;return c.push('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">Access control</h4><div class="g-dialog-subtitle">'),"folder"==e?c.push('<i class="icon-folder"></i>'):"collection"==e&&c.push('<i class="icon-sitemap"></i>'),c.push(""+jade.escape(null==(b=f.name())?"":b)+'</div></div><div class="modal-body g-access-modal-body"><div class="g-public-container"><div class="radio"><label><input id="g-access-private" type="radio" name="privacy"'+jade.attr("checked",g?h:"checked",!0,!1)+'/><i class="icon-lock"></i>Private &mdash; Access is required to view this resource</label></div><div class="radio"><label><input id="g-access-public" type="radio" name="privacy"'+jade.attr("checked",g?"checked":h,!0,!1)+'/><i class="icon-globe"></i>Public &mdash; Anyone can view this resource</label></div></div><div class="g-ac-list-title"><i class="icon-key-1"></i> Permissions</div><div class="g-ac-list"><div id="g-ac-list-groups"></div><div id="g-ac-list-users"></div></div><div class="g-grant-access-container"><form role="form"><div class="form-group"><label for="addAccess">Grant access to another group or user</label><div class="g-search-field-container"></div></div></form></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">Close</a><button type="submit" class="g-save-access-list btn btn-small btn-primary"><i class="icon-ok"></i> Save</button></div></div></div>'),c.join("")},this.jade.templates.accessEntry=function(a){var b,c=[],d=a||{},e=d.entry,f=d.type,g=d.accessTypes;c.push("<div"+jade.attr("resourceid",""+e.id,!0,!1)+jade.cls(["g-"+f+"-access-entry"],[!0])+'><div class="g-access-col-left">');var h="group"==f?"users":"user";c.push('<div class="g-access-icon"><i'+jade.cls(["icon-"+h],[!0])+'></i></div><div class="g-access-desc"><div class="g-desc-title">'+jade.escape(null==(b=e.title)?"":b)+'</div><div class="g-desc-subtitle">'+jade.escape(null==(b=e.subtitle)?"":b)+'</div></div></div><div class="g-access-col-right"><select>');var i=null;e.level==g.READ&&(i="selected"),c.push("<option"+jade.attr("value",""+g.READ,!0,!1)+jade.attr("selected",i,!0,!1)+">Can view</option>");var i=null;e.level==g.WRITE&&(i="selected"),c.push("<option"+jade.attr("value",""+g.WRITE,!0,!1)+jade.attr("selected",i,!0,!1)+">Can edit</option>");var i=null;return e.level==g.ADMIN&&(i="selected"),c.push("<option"+jade.attr("value",""+g.ADMIN,!0,!1)+jade.attr("selected",i,!0,!1)+'>Is owner</option></select><a title="Remove access" class="g-action-remove-access"><i class="icon-block"></i></a></div></div>'),c.join("")},this.jade.templates.checkedActionsMenu=function(a){var b,c=[],d=a||{},e=d.folderCount,f=d.itemCount,g=d.minFolderLevel,h=d.AccessType,i=d.minItemLevel;return c.push('<li role="presentation" class="g-checked-menu-header dropdown-header">'),e&&c.push('<i class="icon-folder"></i><span class="g-checked-folder-count">'+jade.escape(null==(b=e)?"":b)+"</span>"),f&&c.push('<i class="icon-doc-text-inv"></i><span class="g-checked-item-count">'+jade.escape(null==(b=f)?"":b)+"</span>"),c.push('</li><li><a class="g-download-checked"><i class="icon-download"></i>Download checked resources</a></li>'),g>=h.ADMIN&&i>=h.WRITE&&c.push('<li class="g-admin divider"></li><li class="g-admin"><a class="g-delete-checked"><i class="icon-trash"></i>Delete checked resources</a></li>'),c.join("")},this.jade.templates.confirmDialog=function(a){var b,c=[],d=a||{},e=d.params;return c.push('<div class="modal-dialog"><div class="modal-content"><div class="modal-body"><p></p></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">'+jade.escape(null==(b=e.noText)?"":b)+'</a><a id="g-confirm-button"'+jade.cls(["btn","btn-small",""+e.yesClass],[null,null,!0])+">"+jade.escape(null==(b=e.yesText)?"":b)+"</a></div></div></div>"),c.join("")},this.jade.templates.editAssetstoreWidget=function(a){var b=[],c=a||{},d=c.assetstore,e=c.types;return b.push('<div class="modal-dialog"><div class="modal-content"><form id="g-assetstore-edit-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">Edit assetstore</h4></div><div class="modal-body"><div class="form-group"><label for="g-edit-name" class="control-label">Assetstore Name</label><input id="g-edit-name" type="text" placeholder="Name" class="input-sm form-control"/></div>'),d.get("type")==e.FILESYSTEM&&b.push('<div class="form-group"><label for="g-edit-fs-root" class="control-label">Root directory</label><input id="g-edit-fs-root" type="text" placeholder="Root directory" class="input-sm form-control"/></div>'),d.get("type")==e.GRIDFS&&b.push('<div class="form-group"><label for="g-edit-gridfs-db" class="control-label">Database name</label><input id="g-edit-gridfs-db" type="text" placeholder="Database name" class="input-sm form-control"/></div>'),d.get("type")==e.S3&&b.push('<div class="form-group"><label for="g-edit-s3-bucket" class="control-label">S3 bucket name</label><input id="g-edit-s3-bucket" type="text" placeholder="Bucket" class="input-sm form-control"/></div><div class="form-group"><label for="g-edit-s3-prefix" class="control-label">Path prefix (optional)</label><input id="g-edit-s3-prefix" type="text" placeholder="Prefix" class="input-sm form-control"/></div><div class="form-group"><label for="g-edit-s3-access-key-id" class="control-label">Access key ID</label><input id="g-edit-s3-access-key-id" type="text" placeholder="Access key ID" class="input-sm form-control"/></div><div class="form-group"><label for="g-edit-s3-secret" class="control-label">Secret access key</label><input id="g-edit-s3-secret" type="text" placeholder="Secret access key" class="input-sm form-control"/></div><div class="form-group"><label for="g-edit-s3-service" class="control-label">Service</label><input id="g-edit-s3-service" type="text" placeholder="Service name" class="input-sm form-control"/></div>'),d.get("hasFiles")&&b.push('<div><i class="icon-attention"></i><b>Warning:</b> This assetstore contains files.  If you edit where the assetstore is located or how it is reached, those files may become unreachable.</div>'),b.push('<div class="g-validation-failed-message"></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">Cancel</a>'),b.push(d.get("hasFiles")?'<button type="submit" class="g-save-assetstore btn btn-small btn-primary btn-danger"><i class="icon-edit"></i>Save<i class="icon-attention"></i></button>':'<button type="submit" class="g-save-assetstore btn btn-small btn-primary"><i class="icon-edit"></i>Save</button>'),b.push("</div></form></div></div>"),b.join("")},this.jade.templates.editCollectionWidget=function(a){var b=[],c=a||{},d=c.collection;return b.push('<div class="modal-dialog"><div class="modal-content"><form id="g-collection-edit-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">'),b.push(d?"Edit collection":"Create collection"),b.push('</h4></div><div class="modal-body"><div class="form-group"><label for="g-name" class="control-label">Name</label><input id="g-name" type="text" placeholder="Enter collection name" class="input-sm form-control"/></div><div class="form-group"><label for="g-description" class="control-label">Description (optional)</label><textarea id="g-description" placeholder="Enter collection description" class="input-sm form-control"></textarea></div><div class="g-validation-failed-message"></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">Cancel</a><button type="submit" class="g-save-collection btn btn-small btn-primary">'),b.push(d?'<i class="icon-edit"></i>Save':'<i class="icon-plus-squared"></i>Create'),b.push("</button></div></form></div></div>"),b.join("")},this.jade.templates.editFileWidget=function(a){var b=[],c=a||{},d=c.file;return b.push('<div class="modal-dialog"><div class="modal-content"><form id="g-file-edit-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">Edit file</h4></div><div class="modal-body"><div class="form-group"><label for="g-name" class="control-label">Name</label><input id="g-name" type="text" placeholder="Enter file name"'+jade.attr("value",""+d.get("name"),!0,!1)+' class="input-sm form-control"/></div><div class="form-group"><label for="g-mimetype" class="control-label">MIME type</label><input id="g-mimetype" type="text" placeholder="Enter MIME type"'+jade.attr("value",""+d.get("mimeType"),!0,!1)+' class="input-sm form-control"/></div><div class="g-validation-failed-message"></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">Cancel</a><button type="submit" class="g-save-file btn btn-small btn-primary"><i class="icon-edit"></i>Save</button></div></form></div></div>'),b.join("")},this.jade.templates.editFolderWidget=function(a){var b=[],c=a||{},d=c.folder;return b.push('<div class="modal-dialog"><div class="modal-content"><form id="g-folder-edit-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">'),b.push(d?"Edit folder":"Create folder"),b.push('</h4></div><div class="modal-body"><div class="form-group"><label for="g-name" class="control-label">Name</label><input id="g-name" type="text" placeholder="Enter folder name" class="input-sm form-control"/></div><div class="form-group"><label for="g-description" class="control-label">Description (optional)</label><textarea id="g-description" placeholder="Enter folder description" class="input-sm form-control"></textarea></div><div class="g-validation-failed-message"></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">Cancel</a><button type="submit" class="g-save-folder btn btn-small btn-primary">'),b.push(d?'<i class="icon-edit"></i>Save':'<i class="icon-plus-squared"></i>Create'),b.push("</button></div></form></div></div>"),b.join("")},this.jade.templates.editGroupWidget=function(a){var b=[],c=a||{},d=c.group,e=c.public,f=c.undefined;return b.push('<div class="modal-dialog"><div class="modal-content"><form id="g-group-edit-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">'),b.push(d?"Edit group":"Create group"),b.push('</h4></div><div class="modal-body"><div class="g-public-container"><div class="radio"><label><input id="g-access-private" type="radio" name="privacy"'+jade.attr("checked",e?f:"checked",!0,!1)+'/><i class="icon-lock"></i>Private &mdash; Only members can see this group</label></div><div class="radio"><label><input id="g-access-public" type="radio" name="privacy"'+jade.attr("checked",e?"checked":f,!0,!1)+'/><i class="icon-globe"></i>Public &mdash; Anyone can see this group</label></div></div><div class="form-group"><label for="g-name" class="control-label">Name</label><input id="g-name" type="text" placeholder="Enter group name" class="input-sm form-control"/></div><div class="form-group"><label for="g-description" class="control-label">Description (optional)</label><textarea id="g-description" placeholder="Enter group description" class="input-sm form-control"></textarea></div><div class="g-validation-failed-message"></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">Cancel</a><button type="submit" class="g-save-group btn btn-small btn-primary">'),b.push(d?'<i class="icon-edit"></i>Save':'<i class="icon-plus-squared"></i>Create'),b.push("</button></div></form></div></div>"),b.join("")},this.jade.templates.editItemWidget=function(a){var b=[],c=a||{},d=c.item;return b.push('<div class="modal-dialog"><div class="modal-content"><form id="g-item-edit-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">'),b.push(d?"Edit item":"Create item"),b.push('</h4></div><div class="modal-body"><div class="form-group"><label for="g-name" class="control-label">Name</label><input id="g-name" type="text" placeholder="Enter item name" class="input-sm form-control"/></div><div class="form-group"><label for="g-description" class="control-label">Description (optional)</label><textarea id="g-description" placeholder="Enter item description" class="input-sm form-control"></textarea></div><div class="g-validation-failed-message"></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">Cancel</a><button type="submit" class="g-save-item btn btn-small btn-primary">'),b.push(d?'<i class="icon-edit"></i>Save':'<i class="icon-plus-squared"></i>Create'),b.push("</button></div></form></div></div>"),b.join("")},this.jade.templates.fileList=function(a){var b,c=[],d=a||{},e=d.files,f=d.hasMore;return c.push('<ul class="g-file-list">'),function(){var a=e;if("number"==typeof a.length)for(var d=0,f=a.length;f>d;d++){var g=a[d];c.push('<li class="g-file-list-entry"><a'+jade.attr("cid",""+g.cid,!0,!1)+jade.attr("target",""+(g.get("linkUrl")?"_blank":"_self"),!0,!1)+' class="g-file-list-link">'),c.push(g.get("linkUrl")?'<i class="icon-link"></i><span class="g-file-name">'+jade.escape(null==(b=g.get("name"))?"":b)+'</span><i class="icon-link-ext"></i>':'<i class="icon-doc-inv"></i>'+jade.escape(null==(b=g.get("name"))?"":b)),c.push("</a><div"+jade.attr("file-cid",""+g.cid,!0,!1)+' class="g-file-actions-container"><a title="Edit file info" class="g-update-info"><i class="icon-edit"></i></a><a title="Replace file contents" class="g-update-contents"><i class="icon-upload"></i></a></div></li>')}else{var f=0;for(var d in a){f++;var g=a[d];c.push('<li class="g-file-list-entry"><a'+jade.attr("cid",""+g.cid,!0,!1)+jade.attr("target",""+(g.get("linkUrl")?"_blank":"_self"),!0,!1)+' class="g-file-list-link">'),c.push(g.get("linkUrl")?'<i class="icon-link"></i><span class="g-file-name">'+jade.escape(null==(b=g.get("name"))?"":b)+'</span><i class="icon-link-ext"></i>':'<i class="icon-doc-inv"></i>'+jade.escape(null==(b=g.get("name"))?"":b)),c.push("</a><div"+jade.attr("file-cid",""+g.cid,!0,!1)+' class="g-file-actions-container"><a title="Edit file info" class="g-update-info"><i class="icon-edit"></i></a><a title="Replace file contents" class="g-update-contents"><i class="icon-upload"></i></a></div></li>')}}}.call(this),f&&c.push('<li class="g-show-more"><a class="g-show-more-files"><i class="icon-level-down"></i>Show more files...</a></li>'),c.push("</ul>"),c.join("")},this.jade.templates.folderList=function(a){var b,c=[],d=a||{},e=d.folders,f=d.hasMore;return c.push('<ul class="g-folder-list">'),function(){var a=e;if("number"==typeof a.length)for(var d=0,f=a.length;f>d;d++){var g=a[d];c.push('<li class="g-folder-list-entry"><input type="checkbox"'+jade.attr("g-folder-cid",""+g.cid,!0,!1)+' class="g-list-checkbox"/><a'+jade.attr("g-folder-cid",""+g.cid,!0,!1)+' class="g-folder-list-link"><i class="icon-folder"></i>'+jade.escape(null==(b=g.get("name"))?"":b)+'<i class="icon-right-dir"></i></a><div class="g-folder-privacy">'),c.push(g.get("public")?'<i class="icon-globe"></i>Public':'<i class="icon-lock"></i>Private'),c.push("</div></li>")}else{var f=0;for(var d in a){f++;var g=a[d];c.push('<li class="g-folder-list-entry"><input type="checkbox"'+jade.attr("g-folder-cid",""+g.cid,!0,!1)+' class="g-list-checkbox"/><a'+jade.attr("g-folder-cid",""+g.cid,!0,!1)+' class="g-folder-list-link"><i class="icon-folder"></i>'+jade.escape(null==(b=g.get("name"))?"":b)+'<i class="icon-right-dir"></i></a><div class="g-folder-privacy">'),c.push(g.get("public")?'<i class="icon-globe"></i>Public':'<i class="icon-lock"></i>Private'),c.push("</div></li>")}}}.call(this),f&&c.push('<li class="g-show-more"><a class="g-show-more-folders"><i class="icon-level-down"></i>Show more folders...</a></li>'),c.push("</ul>"),c.join("")},this.jade.templates.groupAdminList=function(a){var b,c=[],d=a||{},e=d.admins,f=d.level,g=d.accessType;return c.push('<div class="g-group-admins-header g-group-list-header"><i class="icon-star"></i> Administrators</div><div class="g-group-admins-body"><ul class="g-group-admins">'),function(){var a=e;if("number"==typeof a.length)for(var d=0,h=a.length;h>d;d++){var i=a[d];c.push("<li"+jade.attr("userid",""+i.id,!0,!1)+jade.attr("username",""+i.name,!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=i.name)?"":b)+" ("+jade.escape(null==(b=i.login)?"":b)+')</a><div class="g-group-member-controls pull-right">'),f>=g.ADMIN&&c.push('<a title="Demote to member" class="g-group-admin-demote"><i class="icon-down-big"></i></a>'),c.push("</div></li>")}else{var h=0;for(var d in a){h++;var i=a[d];c.push("<li"+jade.attr("userid",""+i.id,!0,!1)+jade.attr("username",""+i.name,!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=i.name)?"":b)+" ("+jade.escape(null==(b=i.login)?"":b)+')</a><div class="g-group-member-controls pull-right">'),f>=g.ADMIN&&c.push('<a title="Demote to member" class="g-group-admin-demote"><i class="icon-down-big"></i></a>'),c.push("</div></li>")}}}.call(this),e.length||c.push('<div class="g-member-list-empty"><i class="icon-info-circled"></i> There are no administrators in this group.</div>'),c.push("</ul></div>"),c.join("")},this.jade.templates.groupInviteDialog=function(a){var b,c=[],d=a||{},e=d.user,f=d.level,g=d.accessType;return c.push('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">Invite user to group</h4><div class="g-dialog-subtitle"><i class="icon-user"></i>'+jade.escape(null==(b=e.text)?"":b)+'</div></div><div class="modal-body"><label for="g-role" class="control-label">Select a role for this user</label><div id="g-invite-role-container" class="panel-group"><div class="panel panel-default"><div class="panel-heading"><div class="panel-title"><a data-toggle="collapse" data-parent="#g-invite-role-container" href="#g-invite-role-member">Invite as member</a></div></div><div id="g-invite-role-member" class="panel-collapse collapse in"><div class="panel-body"><p>Group members are able to gain all privileges granted to\nthe group itself on other resources. They are able to view the\ngroup, but may not change properties of the group.</p><div class="g-invite-as-member btn btn-primary"><i class="icon-mail"></i> Invite as member</div></div></div></div><div class="panel panel-default"><div class="panel-heading"><div class="panel-title"><a data-toggle="collapse" data-parent="#g-invite-role-container" href="#g-invite-role-moderator">Invite as moderator</a></div></div><div id="g-invite-role-moderator" class="panel-collapse collapse"><div class="panel-body"><p>Group moderators are members of the group who are also granted\nthe power to add and remove users from the group, and edit\ngroup properties.</p><div class="g-invite-as-moderator btn btn-primary"><i class="icon-mail"></i> Invite as moderator</div></div></div></div>'),f>g.WRITE&&c.push('<div class="panel panel-default"><div class="panel-heading"><div class="panel-title"><a data-toggle="collapse" data-parent="#g-invite-role-container" href="#g-invite-role-admin">Invite as administrator</a></div></div><div id="g-invite-role-admin" class="panel-collapse collapse"><div class="panel-body"><p>Group administrators have all the power of group moderators,\nand additionally can also promote group members to moderators\nor administrators, and also have the power to delete the\ngroup itself.</p><div class="g-invite-as-admin btn btn-primary"><i class="icon-mail"></i> Invite as administrator</div></div></div></div>'),c.push('</div><div class="g-validation-failed-message"></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">Cancel</a></div></div></div>'),c.join("")},this.jade.templates.groupInviteList=function(a){var b,c=[],d=a||{},e=d.invitees,f=d.level,g=d.accessType;return c.push('<ul class="g-group-invites">'),function(){var a=e;if("number"==typeof a.length)for(var d=0,h=a.length;h>d;d++){var i=a[d];c.push("<li"+jade.attr("cid",""+i.cid,!0,!1)+jade.attr("username",""+i.name(),!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=i.name())?"":b)+" ("+jade.escape(null==(b=i.get("login"))?"":b)+')</a><div class="g-group-member-controls pull-right">'),f>=g.WRITE&&c.push('<a title="Uninvite this user" class="g-group-uninvite"><i class="icon-block"></i></a>'),c.push("</div></li>")}else{var h=0;for(var d in a){h++;var i=a[d];c.push("<li"+jade.attr("cid",""+i.cid,!0,!1)+jade.attr("username",""+i.name(),!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=i.name())?"":b)+" ("+jade.escape(null==(b=i.get("login"))?"":b)+')</a><div class="g-group-member-controls pull-right">'),f>=g.WRITE&&c.push('<a title="Uninvite this user" class="g-group-uninvite"><i class="icon-block"></i></a>'),c.push("</div></li>")}}}.call(this),e.length||c.push('<div class="g-member-list-empty"><i class="icon-info-circled"></i> There are no pending invitations to this group.</div>'),c.push("</ul>"),c.join("")},this.jade.templates.groupMemberList=function(a){var b,c=[],d=a||{},e=d.level,f=d.accessType,g=d.members;return c.push('<div class="g-group-members-header g-group-list-header"><i class="icon-users"></i> Members'),e>=f.WRITE&&c.push('<form role="form" class="g-group-invite-form form-inline"><span><i class="icon-mail-alt"></i></span><div class="form-group g-group-invite-container"></div></form>'),c.push('<div class="g-member-pagination"></div></div><div class="g-group-members-body"><ul class="g-group-members">'),function(){var a=g;if("number"==typeof a.length)for(var d=0,h=a.length;h>d;d++){var i=a[d];c.push("<li"+jade.attr("cid",""+i.cid,!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=i.name())?"":b)+" ("+jade.escape(null==(b=i.get("login"))?"":b)+')</a><div class="g-group-member-controls pull-right">'),e>=f.ADMIN&&c.push('<span class="dropdown"><a title="Promote user" data-toggle="dropdown" class="g-group-member-promote dropdown-toggle"><i class="icon-up-big"></i><i class="icon-down-dir"></i></a><ul role="menu" class="dropdown-menu pull-right"><li role="presentation"><a role="menuitem" class="g-promote-moderator"><i class="icon-plus"></i>Promote to moderator</a></li><li role="presentation"><a role="menuitem" class="g-promote-admin"><i class="icon-plus"></i>Promote to administrator</a></li></ul></span>'),e>=f.WRITE&&c.push('<a title="Remove user from the group" class="g-group-member-remove"><i class="icon-block"></i></a>'),c.push("</div></li>")}else{var h=0;for(var d in a){h++;var i=a[d];c.push("<li"+jade.attr("cid",""+i.cid,!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=i.name())?"":b)+" ("+jade.escape(null==(b=i.get("login"))?"":b)+')</a><div class="g-group-member-controls pull-right">'),e>=f.ADMIN&&c.push('<span class="dropdown"><a title="Promote user" data-toggle="dropdown" class="g-group-member-promote dropdown-toggle"><i class="icon-up-big"></i><i class="icon-down-dir"></i></a><ul role="menu" class="dropdown-menu pull-right"><li role="presentation"><a role="menuitem" class="g-promote-moderator"><i class="icon-plus"></i>Promote to moderator</a></li><li role="presentation"><a role="menuitem" class="g-promote-admin"><i class="icon-plus"></i>Promote to administrator</a></li></ul></span>'),e>=f.WRITE&&c.push('<a title="Remove user from the group" class="g-group-member-remove"><i class="icon-block"></i></a>'),c.push("</div></li>")}}}.call(this),c.push("</ul></div>"),c.join("")},this.jade.templates.groupModList=function(a){var b,c=[],d=a||{},e=d.moderators,f=d.level,g=d.accessType;return c.push('<div class="g-group-mods-header g-group-list-header"><i class="icon-shield"></i> Moderators</div><div class="g-group-mods-body"><ul class="g-group-mods">'),function(){var a=e;if("number"==typeof a.length)for(var d=0,h=a.length;h>d;d++){var i=a[d];c.push("<li"+jade.attr("userid",""+i.id,!0,!1)+jade.attr("username",""+i.name,!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=i.name)?"":b)+" ("+jade.escape(null==(b=i.login)?"":b)+')</a><div class="g-group-member-controls pull-right">'),f>=g.ADMIN&&c.push('<a title="Demote to member" class="g-group-mod-demote"><i class="icon-down-big"></i></a>'),c.push("</div></li>")
}else{var h=0;for(var d in a){h++;var i=a[d];c.push("<li"+jade.attr("userid",""+i.id,!0,!1)+jade.attr("username",""+i.name,!0,!1)+'><a class="g-member-name"><i class="icon-user"></i> '+jade.escape(null==(b=i.name)?"":b)+" ("+jade.escape(null==(b=i.login)?"":b)+')</a><div class="g-group-member-controls pull-right">'),f>=g.ADMIN&&c.push('<a title="Demote to member" class="g-group-mod-demote"><i class="icon-down-big"></i></a>'),c.push("</div></li>")}}}.call(this),e.length||c.push('<div class="g-member-list-empty"><i class="icon-info-circled"></i> There are no moderators in this group.</div>'),c.push("</ul></div>"),c.join("")},this.jade.templates.hierarchyBreadcrumb=function(a){var b,c=[],d=a||{},e=d.links,f=d.current,g=0;return function(){var a=e;if("number"==typeof a.length)for(var d=0,f=a.length;f>d;d++){var h=a[d];c.push("<li><a"+jade.attr("g-index",""+g,!0,!1)+' class="g-breadcrumb-link">'),"user"==h.resourceName?c.push('<i class="icon-user"></i>&nbsp;'):"collection"==h.resourceName&&c.push('<i class="icon-sitemap"></i>&nbsp;'),c.push(""+jade.escape(null==(b=h.get("name")||h.name())?"":b)+"</a></li>"),g+=1}else{var f=0;for(var d in a){f++;var h=a[d];c.push("<li><a"+jade.attr("g-index",""+g,!0,!1)+' class="g-breadcrumb-link">'),"user"==h.resourceName?c.push('<i class="icon-user"></i>&nbsp;'):"collection"==h.resourceName&&c.push('<i class="icon-sitemap"></i>&nbsp;'),c.push(""+jade.escape(null==(b=h.get("name")||h.name())?"":b)+"</a></li>"),g+=1}}}.call(this),f&&(c.push('<li class="active">'),"user"==f.resourceName?c.push('<i class="icon-user"></i>&nbsp;'):"collection"==f.resourceName&&c.push('<i class="icon-sitemap"></i>&nbsp;'),c.push(""+jade.escape(null==(b=f.get("name")||f.name())?"":b)+"</li>")),g>0&&c.push('<div class="pull-right"><a title="Go up one level" class="g-hierarchy-level-up"><i class="icon-level-up"></i></a></div>'),c.join("")},this.jade.templates.hierarchyWidget=function(a){var b,c=[],d=a||{},e=d.type,f=d.level,g=d.AccessType,h=d.model;return c.push('<div class="g-hierarchy-widget"><div class="g-hierarchy-breadcrumb-bar"><ol class="breadcrumb"></ol></div><div class="g-hierarchy-actions-header"><input type="checkbox" data-toggle="tooltip" title="Select / Unselect all" class="g-select-all"/><div class="btn-group"><button data-toggle="dropdown" disabled="disabled" title="Checked actions" class="g-checked-actions-button btn btn-sm btn-default dropdown-toggle"><i class="icon-check"></i><i class="icon-down-dir"></i></button><ul role="menu" class="g-checked-actions-menu dropdown-menu"></ul></div><div class="g-folder-header-buttons">'),"folder"==e&&(f>=g.WRITE&&c.push('<button title="Upload here" class="g-upload-here-button btn btn-sm btn-success"><i class="icon-upload"></i></button>'),f>=g.ADMIN&&c.push('<button title="Access control" class="g-folder-access-button btn btn-sm btn-warning"><i class="icon-lock"></i></button>')),c.push('<div class="btn-group"><button data-toggle="dropdown" title="Folder actions" class="g-folder-actions-button btn btn-sm btn-default dropdown-toggle"><i class="icon-folder-open"></i><i class="icon-down-dir"></i></button><ul role="menu" class="g-folder-actions-menu dropdown-menu pull-right"><li role="presentation" class="dropdown-header"><i class="icon-folder-open"></i> '+jade.escape(null==(b=h.get("name")||h.name())?"":b)+"</li>"),"folder"==e&&c.push('<li role="presentation"><a role="menuitem" class="g-download-folder"><i class="icon-download"></i>Download folder</a></li>'),f>=g.WRITE&&(c.push('<li role="presentation"><a role="menuitem" class="g-create-subfolder"><i class="icon-folder"></i>Create folder here</a></li>'),"folder"==e&&c.push('<li role="presentation"><a role="menuitem" class="g-create-item"><i class="icon-doc"></i>Create item here</a></li><li role="presentation"><a role="menuitem" class="g-edit-folder"><i class="icon-edit"></i>Edit folder</a></li>')),"folder"==e&&f>=g.ADMIN&&c.push('<li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" class="g-delete-folder"><i class="icon-trash"></i>Delete this folder</a></li>'),c.push('</ul></div></div><div class="g-clear-right"></div></div><div class="g-folder-list-container"></div><div class="g-item-list-container"></div><div class="g-empty-parent-message g-info-message-container hide"><i class="icon-info-circled"></i> This folder is empty.</div></div><div class="g-folder-metadata"></div>'),c.join("")},this.jade.templates.itemBreadcrumb=function(a){var b,c=[],d=a||{},e=d.parentChain;return c.push('<ol class="breadcrumb">'),function(){var a=e;if("number"==typeof a.length)for(var d=0,f=a.length;f>d;d++){var g=a[d];c.push("<li><a"+jade.attr("data-id",""+g.object._id,!0,!1)+jade.attr("data-type",""+g.type,!0,!1)+' class="g-item-breadcrumb-link">'),c.push("user"==g.type?'<i class="icon-user"></i>'+jade.escape(null==(b=g.object.login)?"":b):"collection"==g.type?'<i class="icon-sitemap"></i>'+jade.escape(null==(b=g.object.name)?"":b):""+jade.escape(null==(b=g.object.name)?"":b)),c.push("</a></li>")}else{var f=0;for(var d in a){f++;var g=a[d];c.push("<li><a"+jade.attr("data-id",""+g.object._id,!0,!1)+jade.attr("data-type",""+g.type,!0,!1)+' class="g-item-breadcrumb-link">'),c.push("user"==g.type?'<i class="icon-user"></i>'+jade.escape(null==(b=g.object.login)?"":b):"collection"==g.type?'<i class="icon-sitemap"></i>'+jade.escape(null==(b=g.object.name)?"":b):""+jade.escape(null==(b=g.object.name)?"":b)),c.push("</a></li>")}}}.call(this),c.push('<div class="pull-right"><a title="Go to parent folder" class="g-hierarchy-level-up"><i class="icon-level-up"></i></a></div></ol>'),c.join("")},this.jade.templates.itemList=function(a){var b,c=[],d=a||{},e=d.items,f=d.girder,g=d.hasMore;return c.push('<ul class="g-item-list">'),function(){var a=e;if("number"==typeof a.length)for(var d=0,g=a.length;g>d;d++){var h=a[d];c.push('<li class="g-item-list-entry"><input type="checkbox"'+jade.attr("g-item-cid",""+h.cid,!0,!1)+' class="g-list-checkbox"/><a'+jade.attr("g-item-cid",""+h.cid,!0,!1)+' class="g-item-list-link"><i class="icon-doc-text-inv"></i>'+jade.escape(null==(b=h.get("name"))?"":b)+'</a><div class="g-item-size">'+jade.escape(null==(b=f.formatSize(h.get("size")))?"":b)+"</div></li>")}else{var g=0;for(var d in a){g++;var h=a[d];c.push('<li class="g-item-list-entry"><input type="checkbox"'+jade.attr("g-item-cid",""+h.cid,!0,!1)+' class="g-list-checkbox"/><a'+jade.attr("g-item-cid",""+h.cid,!0,!1)+' class="g-item-list-link"><i class="icon-doc-text-inv"></i>'+jade.escape(null==(b=h.get("name"))?"":b)+'</a><div class="g-item-size">'+jade.escape(null==(b=f.formatSize(h.get("size")))?"":b)+"</div></li>")}}}.call(this),g&&c.push('<li class="g-show-more"><a class="g-show-more-items"><i class="icon-level-down"></i>Show more items...</a></li>'),c.push("</ul>"),c.join("")},this.jade.templates.loadingAnimation=function(){var a=[];return a.push('<div id="g-loading-animation"><div id="g-loading-block-1" class="g-loading-block"></div><div id="g-loading-block-2" class="g-loading-block"></div><div id="g-loading-block-3" class="g-loading-block"></div></div>'),a.join("")},this.jade.templates.metadataWidget=function(a){var b,c=[],d={},e=a||{},f=e.accessLevel,g=e.girder,h=e.meta;return d.metadatum=function(a,d,e,f){this&&this.block,this&&this.attributes||{};e>=f.AccessType.WRITE&&c.push('<button class="btn btn-sm btn-default g-widget-metadata-edit-button"><i class="icon-pencil"></i></button>'),c.push('<span class="g-widget-metadata-key">'+jade.escape(null==(b=a)?"":b)+'</span><span class="g-widget-metadata-value">'+jade.escape(null==(b=d)?"":b)+"</span>")},f>=g.AccessType.WRITE&&c.push('<button title="Add Metadata" class="btn btn-sm btn-primary g-widget-metadata-add-button"><i class="icon-plus"></i></button>'),c.push('<div class="g-widget-metadata-header"><i class="icon-tags"></i> Metadata</div><div class="g-widget-metadata-container">'),function(){var a=h;if("number"==typeof a.length)for(var b=0,e=a.length;e>b;b++){var i=a[b];c.push("<div"+jade.attr("g-key",""+i.key,!0,!1)+jade.attr("g-value",""+i.value,!0,!1)+' class="g-widget-metadata-row">'),d.metadatum(i.key,i.value,f,g),c.push("</div>")}else{var e=0;for(var b in a){e++;var i=a[b];c.push("<div"+jade.attr("g-key",""+i.key,!0,!1)+jade.attr("g-value",""+i.value,!0,!1)+' class="g-widget-metadata-row">'),d.metadatum(i.key,i.value,f,g),c.push("</div>")}}}.call(this),c.push("</div>"),c.join("")},this.jade.templates.metadatumEditWidget=function(a){var b,c=[],d=a||{},e=d.key,f=d.value,g=d.newDatum;c.push('<input type="text"'+jade.attr("value",e,!0,!1)+' placeholder="Key" class="input-sm form-control g-widget-metadata-key-input"/>');var h=f.length<=40?1:f.length<=100?3:5;return c.push('<textarea placeholder="Value"'+jade.attr("rows",h,!0,!1)+' class="input-sm form-control g-widget-metadata-value-input">'+jade.escape(null==(b=f)?"":b)+'</textarea><button title="Cancel" class="btn btn-sm btn-warning g-widget-metadata-cancel-button"><i class="icon-cancel"></i></button><button title="Accept" class="btn btn-sm btn-primary g-widget-metadata-save-button"><i class="icon-ok"></i></button>'),g||c.push('<button title="Delete" class="btn btn-sm btn-danger g-widget-metadata-delete-button"><i class="icon-trash"></i></button>'),c.join("")},this.jade.templates.metadatumView=function(a){var b,c=[],d={},e=a||{},f=e.key,g=e.value,h=e.accessLevel,i=e.girder;return d.metadatum=function(a,d,e,f){this&&this.block,this&&this.attributes||{};e>=f.AccessType.WRITE&&c.push('<button class="btn btn-sm btn-default g-widget-metadata-edit-button"><i class="icon-pencil"></i></button>'),c.push('<span class="g-widget-metadata-key">'+jade.escape(null==(b=a)?"":b)+'</span><span class="g-widget-metadata-value">'+jade.escape(null==(b=d)?"":b)+"</span>")},d.metadatum(f,g,h,i),c.join("")},this.jade.templates.metadatumViewMixin=function(){var a=[];return a.join("")},this.jade.templates.newAssetstore=function(){var a=[];return a.push('<div id="g-assetstore-accordion" class="panel-group"><div class="panel panel-default"><div class="panel-heading"><div class="panel-title"><a data-toggle="collapse" data-parent="#g-assetstore-accordion" href="#g-create-fs-tab"><i class="icon-hdd"></i> Create new<b> Filesystem</b> assetstore</a></div></div><div id="g-create-fs-tab" class="panel-collapse collapse"><div class="panel-body"><p>This type of assetstore will store files in a directory on the\nlocal filesystem, using content-addressed storage to ensure that\ndata is never duplicated on disk. Just specify the root directory\nthat files will be stored under.</p><p>If the specified root directory does not already exist, the server\nwill attempt to create it.</p><form id="g-new-fs-form" role="form"><div class="form-group"><label for="g-new-fs-name" class="control-label">Assetstore name</label><input id="g-new-fs-name" type="text" placeholder="Name" class="input-sm form-control"/></div><div class="form-group"><label for="g-new-fs-root" class="control-label">Root directory</label><input id="g-new-fs-root" type="text" placeholder="Root directory" class="input-sm form-control"/></div><p id="g-new-fs-error" class="g-validation-failed-message"></p><input type="submit" value="Create" class="g-new-assetstore-submit btn btn-sm btn-primary"/></form></div></div></div><div class="panel panel-default"><div class="panel-heading"><div class="panel-title"><a data-toggle="collapse" data-parent="#g-assetstore-accordion" href="#g-create-gridfs-tab"><i class="icon-leaf"></i> Create new<b> GridFS</b> assetstore</a></div></div><div id="g-create-gridfs-tab" class="panel-collapse collapse"><div class="panel-body"><p>This type of assetstore uses mongoDB\'s<a target="_blank" href="http://docs.mongodb.org/manual/core/gridfs/"> GridFS</a> storage engine. The files should be stored in a separate database\n from the rest of the server\'s information to avoid locking issues.</p><form id="g-new-gridfs-form" role="form"><div class="form-group"><label for="g-new-gridfs-name" class="control-label">Assetstore name</label><input id="g-new-gridfs-name" type="text" placeholder="Name" class="input-sm form-control"/></div><div class="form-group"><label for="g-new-gridfs-db" class="control-label">Database name</label><input id="g-new-gridfs-db" type="text" placeholder="Database name" class="input-sm form-control"/></div><p id="g-new-gridfs-error" class="g-validation-failed-message"></p><input type="submit" value="Create" class="g-new-assetstore-submit btn btn-sm btn-primary"/></form></div></div></div><div class="panel panel-default"><div class="panel-heading"><div class="panel-title"><a data-toggle="collapse" data-parent="#g-assetstore-accordion" href="#g-create-s3-tab"><i class="icon-upload-cloud"></i> Create new<b> Amazon S3</b> assetstore</a></div></div><div id="g-create-s3-tab" class="panel-collapse collapse"><div class="panel-body"><p>This type of assetstore keeps files in an<a target="_blank" href="http://aws.amazon.com/s3/"> Amazon S3</a> bucket.  The service defaults to s3.amazonaws.com.  You can\n specify an alternate service, including an optional protocol and\n port using the form [http[s]://](service domain)[:(port)].</p><form id="g-new-s3-form" role="form"><div class="form-group"><label for="g-new-s3-name" class="control-label">Assetstore name</label><input id="g-new-s3-name" type="text" placeholder="Name" class="input-sm form-control"/></div><div class="form-group"><label for="g-new-s3-bucket" class="control-label">S3 bucket name</label><input id="g-new-s3-bucket" type="text" placeholder="Bucket" class="input-sm form-control"/></div><div class="form-group"><label for="g-new-s3-prefix" class="control-label">Path prefix (optional)</label><input id="g-new-s3-prefix" type="text" placeholder="Prefix" class="input-sm form-control"/></div><div class="form-group"><label for="g-new-s3-access-key-id" class="control-label">Access key ID</label><input id="g-new-s3-access-key-id" type="text" placeholder="Access key ID" class="input-sm form-control"/></div><div class="form-group"><label for="g-new-s3-secret" class="control-label">Secret access key</label><input id="g-new-s3-secret" type="text" placeholder="Secret access key" class="input-sm form-control"/></div><div class="form-group"><label for="g-new-s3-service" class="control-label">Service</label><input id="g-new-s3-service" type="text" placeholder="Service name" class="input-sm form-control"/></div><p id="g-new-s3-error" class="g-validation-failed-message"></p><input type="submit" value="Create" class="g-new-assetstore-submit btn btn-sm btn-primary"/></form></div></div></div></div>'),a.join("")},this.jade.templates.paginateWidget=function(a){var b,c=[],d=a||{},e=d.collection;return c.push('<ul class="pagination pagination-sm"><li class="g-page-prev disabled"><a>&laquo; Prev</a></li><li class="active"><a class="g-page-number">Page '+jade.escape(null==(b=e.pageNum()+1)?"":b)+'</a></li><li class="g-page-next disabled"><a>Next &raquo;</a></li></ul>'),c.join("")},this.jade.templates.pluginConfigBreadcrumb=function(a){var b,c=[],d=a||{},e=d.pluginName;return c.push('<div class="g-plugin-config-breadcrumbs"><ol class="breadcrumb"><li><a class="g-admin-console-link"><i class="icon-wrench"></i>Admin console</a></li><li><a class="g-plugins-link"><i class="icon-puzzle"></i>Plugins</a></li><li class="active"><i class="icon-cog"></i>'+jade.escape(null==(b=e)?"":b)+"</li></ol></div>"),c.join("")},this.jade.templates.searchField=function(a){var b=[],c=a||{},d=c.placeholder;return b.push('<div class="g-search-wrapper"><a title="Search options" tabindex="0" class="g-search-options-button btn btn-sm"><i class="icon-search"></i></a><input type="text"'+jade.attr("placeholder",""+d,!0,!1)+' class="g-search-field form-control input-sm"/><div class="g-search-results dropdown"><ul role="menu" class="dropdown-menu"></ul></div></div>'),b.join("")},this.jade.templates.searchHelp=function(){var a=[];return a.push('<p class="g-search-help-text">By default, search results will be returned if they contain any of the terms\nof the search. If you wish to search for documents containing all of the\nterms, place them in quotes. Examples:\n</p><ul class="g-search-examples-list"><li><code>cat dog</code> returns documents containing either "cat" or "dog".</li><li><code>"cat" "dog"</code> returns documents containing both "cat" and "dog".</li><li><code>"cat dog"</code> returns documents containing the phrase "cat dog".</li></ul>'),a.join("")},this.jade.templates.searchResults=function(a){var b,c=[],d=a||{},e=d.results;return function(){var a=e;if("number"==typeof a.length)for(var d=0,f=a.length;f>d;d++){var g=a[d];c.push('<li role="presentation" class="g-search-result"><a'+jade.attr("resourceid",""+g.id,!0,!1)+jade.attr("resourcetype",""+g.type,!0,!1)+' role="menuitem" tabindex="-1"><i'+jade.cls(["icon-"+g.icon],[!0])+"></i> "+jade.escape(null==(b=g.text)?"":b)+"</a></li>")}else{var f=0;for(var d in a){f++;var g=a[d];c.push('<li role="presentation" class="g-search-result"><a'+jade.attr("resourceid",""+g.id,!0,!1)+jade.attr("resourcetype",""+g.type,!0,!1)+' role="menuitem" tabindex="-1"><i'+jade.cls(["icon-"+g.icon],[!0])+"></i> "+jade.escape(null==(b=g.text)?"":b)+"</a></li>")}}}.call(this),0==e.length&&c.push('<li role="presentation" class="g-no-search-results disabled"><a role="menuitem" tabindex="-1"><i class="icon-block"></i> No results found</a></li>'),c.join("")},this.jade.templates.taskProgress=function(a){var b,c=[],d=a||{},e=d.progressClass,f=d.width,g=d.barClass,h=d.progress;return c.push('<div class="g-task-progress-top"><div'+jade.cls(["g-task-progress-bar","progress",""+e],[null,null,!0])+"><div"+jade.attr("style","width: "+f+";",!0,!1)+jade.cls(["progress-bar",""+g],[null,!0])+'></div></div><div class="g-task-progress-title">'+jade.escape(null==(b=h.data.title)?"":b)+'</div></div><div class="g-task-progress-bottom"><div class="g-task-progress-message">'+jade.escape(null==(b=h.data.message)?"":b)+"</div></div>"),c.join("")},this.jade.templates.uploadWidget=function(a){var b,c=[],d=a||{},e=d.title,f=d.parentType,g=d.parent;return c.push('<div class="modal-dialog"><div class="modal-content"><form id="g-upload-form" role="form" class="modal-form"><div class="modal-header"><button data-dismiss="modal" aria-hidden="true" type="button" class="close">&times;</button><h4 class="modal-title">'+jade.escape(null==(b=e)?"":b)+'</h4><div class="g-dialog-subtitle">'),"folder"===f?c.push('<i class="icon-folder-open"></i>'):"item"===f?c.push('<i class="icon-doc-text-inv"></i>'):"file"===f&&c.push('<i class="icon-doc-inv"></i>'),c.push(""+jade.escape(null==(b=g.name())?"":b)+'</div></div><div class="modal-body"><div class="g-drop-zone"><i class="icon-docs"></i>'),c.push("file"===f?" Browse or drop a file here":" Browse or drop files here"),c.push('</div><div class="form-group hide">'),c.push("file"===f?'<input id="g-files" type="file"/>':'<input id="g-files" type="file" multiple="multiple"/>'),c.push('</div><div class="g-current-progress-message"></div><div class="g-progress-current progress progress-striped hide"><div role="progressbar" class="progress-bar progress-bar-info"></div></div><div class="g-overall-progress-message">No files selected</div><div class="g-progress-overall progress progress-striped hide"><div role="progressbar" class="progress-bar progress-bar-info"></div></div><div class="g-upload-error-message g-validation-failed-message"></div></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-small btn-default">Close</a><button type="submit" class="g-start-upload btn btn-small btn-primary disabled"><i class="icon-upload"></i> Start Upload</button></div></form></div></div>'),c.join("")},!window.console)var console={log:function(){},error:function(){}};var girder={models:{},collections:{},views:{},apiRoot:$("#g-global-info-apiroot").text(),staticRoot:$("#g-global-info-staticroot").text(),currentUser:null,events:_.clone(Backbone.Events),uploadHandlers:{},handleRouting:!0,UPLOAD_CHUNK_SIZE:67108864,SORT_ASC:1,SORT_DESC:-1,MONTHS:["January","February","March","April","May","June","July","August","September","October","November","December"],AccessType:{NONE:-1,READ:0,WRITE:1,ADMIN:2},AssetstoreType:{FILESYSTEM:0,GRIDFS:1,S3:2},restRequest:function(a){var b={dataType:"json",type:"GET",error:function(a){var b;401===a.status?(girder.events.trigger("g:loginUi"),b={text:"You must log in to view this resource",type:"warning",timeout:4e3,icon:"info"}):b=403===a.status?{text:"Access denied. See the console for more details.",type:"danger",timeout:5e3,icon:"attention"}:{text:"An error occurred while communicating with the server. Details have been logged in the console.",type:"danger",timeout:5e3,icon:"attention"},girder.events.trigger("g:alert",b),console.error(a.status+" "+a.statusText,a.responseText),girder.lastError=a}};"/"!==a.path.substring(0,1)&&(a.path="/"+a.path),a.url=girder.apiRoot+a.path,a=_.extend(b,a);var c=girder.cookie.find("girderToken");return c&&(a.headers=a.headers||{},a.headers["Girder-Token"]=c),Backbone.ajax(a)}};girder.versionInfo={git:!0,SHA:"e2cefbaf4276b83b66c7d31b927e30ca57f1f55a",shortSHA:"e2cefba",date:"2014-10-27T15:11:43",apiVersion:"1.0.1"},girder.App=Backbone.View.extend({el:"body",initialize:function(){girder.restRequest({path:"user/me"}).done(_.bind(function(a){girder.eventStream=new girder.EventStream,a&&(girder.currentUser=new girder.models.UserModel(a),girder.eventStream.open()),this.render(),Backbone.history.start({pushState:!1})},this)),girder.events.on("g:navigateTo",this.navigateTo,this),girder.events.on("g:loginUi",this.loginDialog,this),girder.events.on("g:registerUi",this.registerDialog,this),girder.events.on("g:resetPasswordUi",this.resetPasswordDialog,this),girder.events.on("g:alert",this.alert,this),girder.events.on("g:login",this.login,this)},render:function(){return this.$el.html(jade.templates.layout()),this.globalNavView=new girder.views.LayoutGlobalNavView({el:this.$("#g-global-nav-container")}).render(),new girder.views.LayoutHeaderView({el:this.$("#g-app-header-container")}).render(),new girder.views.LayoutFooterView({el:this.$("#g-app-footer-container")}).render(),new girder.views.ProgressListView({el:this.$("#g-app-progress-container"),eventStream:girder.eventStream}).render(),this},navigateTo:function(a,b){var c=this.$("#g-app-body-container");return this.globalNavView.deactivateAll(),b=b||{},a?(c.off(),this.bodyView&&girder.events.off(null,null,this.bodyView),b=_.extend(b,{el:this.$("#g-app-body-container")}),this.bodyView=new a(b)):console.error("Undefined page."),this},closeDialogIfUser:function(){return girder.currentUser?($(".modal").girderModal("close"),!0):!1},loginDialog:function(){this.closeDialogIfUser()||(this.loginView||(this.loginView=new girder.views.LoginView({el:this.$("#g-dialog-container")})),this.loginView.render())},registerDialog:function(){this.closeDialogIfUser()||(this.registerView||(this.registerView=new girder.views.RegisterView({el:this.$("#g-dialog-container")})),this.registerView.render())},resetPasswordDialog:function(){this.resetPasswordView||(this.resetPasswordView=new girder.views.ResetPasswordView({el:this.$("#g-dialog-container")})),this.resetPasswordView.render()},alert:function(a){var b=$(jade.templates.alert({text:a.text,type:a.type||"info",icon:a.icon}));$("#g-alerts-container").append(b),b.fadeIn(500),void 0===a.timeout&&(a.timeout=6e3),a.timeout>0&&window.setTimeout(function(){b.fadeOut(750,function(){$(this).remove()})},a.timeout)},login:function(){var a=girder.dialogs.splitRoute(Backbone.history.fragment).base;Backbone.history.fragment=null,girder.router.navigate(a,{trigger:!0}),girder.currentUser?girder.eventStream.open():girder.eventStream.close()}}),girder.Router=Backbone.Router.extend({execute:function(a,b){b.push(girder.parseQueryString(b.pop()));var c=b[b.length-1];a&&a.apply(this,b),"login"===c.dialog?girder.events.trigger("g:loginUi"):"register"===c.dialog&&girder.events.trigger("g:registerUi")}}),girder.handleRouting?(girder.router=new girder.Router,girder.router.on("route",function(a,b){b.slice(-1)[0].dialog||$(".modal").girderModal("close")})):girder.router={navigate:function(){},route:function(){}},girder.dialogs={splitRoute:function(a){var b,c,d=a.indexOf("?"),e=a.lastIndexOf("?");return c=-1===d?a:a.slice(0,d),b=-1===e?"":a.slice(e+1),{name:b,base:c}},handleClose:function(a,b){if(girder.handleRouting){var c=Backbone.history.fragment,d=this.splitRoute(c),e=girder.parseQueryString(d.name),f=e.dialog;delete e.dialog;var g=$.param(e);g.length>0&&(g="?"+g),f===a&&girder.router.navigate(d.base+g,b)}},handleOpen:function(a,b){if(girder.handleRouting){var c=Backbone.history.fragment,d=this.splitRoute(c),e=girder.parseQueryString(d.name),f=e.dialog;if(f!==a){e.dialog=a;var g=$.param(e);g.length>0&&(g="?"+g),girder.router.navigate(d.base+g,b)}}}},function(){girder.EventStream=function(){return _.extend(this,Backbone.Events)};var a=girder.EventStream.prototype;a.open=function(){if(window.EventSource){this._eventSource=new window.EventSource(girder.apiRoot+"/notification/stream?token="+girder.cookie.find("girderToken"));var a=this;this._eventSource.onmessage=function(b){try{var c=window.JSON.parse(b.data);a.trigger("g:event."+c.type,c)}catch(d){console.error("Invalid JSON from SSE stream: "+b.data+","+d),a.trigger("g:error",b)}}}else console.error("EventSource is not supported on this platform.")},a.close=function(){this._eventSource&&this._eventSource.close()}}(),function(a){a.fn.girderModal=function(b){var c=this;return a(this).is(".modal")&&(a(this).data("bs.modal")&&a(this).data("bs.modal").isShown&&a(this).modal("hide"),a(this).modal("removeBackdrop")),"close"!==b&&(this.off().modal().find('[data-dismiss="modal"]').unbind("click").click(function(){c.modal("hide")}),b!==!1&&b.delegateEvents()),this}}(jQuery),girder.DATE_MONTH=0,girder.DATE_DAY=1,girder.DATE_MINUTE=2,girder.DATE_SECOND=3,girder.formatDate=function(a,b){a=a.replace(" ","T");var c=new Date(a),d=girder.MONTHS[c.getMonth()];return b=b||girder.DATE_MONTH,b>=girder.DATE_DAY&&(d+=" "+c.getDate()+","),d+=" "+c.getFullYear(),b>=girder.DATE_MINUTE&&(d+=" at "+c.getHours()+":"+("0"+c.getMinutes()).slice(-2)),b>=girder.DATE_SECOND&&(d+=":"+("0"+c.getSeconds()).slice(-2)),d},girder.formatSize=function(a){var b=a>1073741824?2:1;1024>a&&(b=0);var c;for(c=0;a>=1024;c+=1)a/=1024;return a.toFixed(b)+" "+["B","KB","MB","GB","TB"][c]},girder.confirm=function(a){a=_.extend({text:"Are you sure?",yesText:"Yes",yesClass:"btn-danger",noText:"Cancel",escapedHtml:!1},a),$("#g-dialog-container").html(jade.templates.confirmDialog({params:a})).girderModal(!1);var b=$("#g-dialog-container").find(".modal-body>p");a.escapedHtml?b.html(a.text):b.text(a.text),$("#g-confirm-button").unbind("click").click(function(){$("#g-dialog-container").modal("hide"),a.confirmCallback()})},girder.localeComparator=function(a,b){var c=a.get(this.sortField),d=b.get(this.sortField);if(void 0!==c&&c.localeCompare){var e=c.localeCompare(d)*this.sortDir;return e||!this.secondarySortField?e:(c=a.get(this.secondarySortField),d=b.get(this.secondarySortField),c.localeCompare(d)*this.sortDir)}return c>d?this.sortDir:d>c?-this.sortDir:0},girder.localeSort=function(a,b){return void 0!==a&&a.localeCompare?a.localeCompare(b):a>b?1:b>a?-1:0},girder.getModelClassByName=function(a){var b=a.charAt(0).toUpperCase();return b+a.substr(1)+"Model"},girder.parseQueryString=function(a){var b={};return a&&_.each(_.map(decodeURI(a).split(/&/g),function(a){var b=a.split("="),c={};if(b.length>=1){var d;2===b.length&&(d=b[1]),c[b[0]]=d}return c}),function(a){_.extend(b,a)}),b},girder.cookie={findAll:function(){var a={};return _(document.cookie.split(";")).chain().map(function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}).each(function(b){var c=b.split("="),d=c[0],e=null,f=_.size(c);f>1&&(e=c.slice(1).join("")),a[d]=e}),a},find:function(a){var b=null,c=this.findAll();return _.each(c,function(c,d){d===a&&(b=c)}),b}},function(){var a={};girder.exposePluginConfig=function(b,c){a[b]=c},girder.getPluginConfigRoute=function(b){return a[b]}}(),function(){girder.uploadHandlers.s3=function(a){return this.params=a,this.startByte=0,_.extend(this,Backbone.Events)};var a=girder.uploadHandlers.s3.prototype;a._xhrProgress=function(a){if(a.lengthComputable){var b=this.payloadLength+a.loaded-a.total;b>=0&&this.trigger("g:upload.progress",{startByte:this.startByte,loaded:b,total:this.params.file.size,file:this.params.file})}},a.execute=function(){var a=this.params.upload.s3,b=this,c=new XMLHttpRequest;c.open(a.request.method,a.request.url),_.each(a.request.headers,function(a,b){c.setRequestHeader(b,a)}),a.chunked?this._multiChunkUpload(c):(this.payloadLength=this.params.file.size,c.onload=function(){200===c.status?(b.trigger("g:upload.chunkSent",{bytes:b.payloadLength}),girder.restRequest({path:"file/completion",type:"POST",data:{uploadId:b.params.upload._id},error:null}).done(_.bind(function(){this.trigger("g:upload.complete")},b)).error(_.bind(function(a){var b;b=0===a.status?"Could not connect to the server.":"An error occurred when resuming upload, check console.",this.trigger("g:upload.error",{message:b})},b))):b.trigger("g:upload.error",{message:"Error occurred uploading to S3 ("+c.status+")."})},c.upload.addEventListener("progress",function(a){b._xhrProgress.call(b,a)}),c.addEventListener("error",function(a){b.trigger("g:upload.error",{message:"Error occurred uploading to S3.",event:a})}),c.send(this.params.file))},a.resume=function(){return this.params.upload.s3.chunked?this._sendNextChunk():void girder.restRequest({path:"file/offset",type:"GET",data:{uploadId:this.params.upload._id},error:null}).done(_.bind(function(a){this.params.upload.s3.request=a,this.execute()},this)).error(_.bind(function(a){var b;b=0===a.status?"Could not connect to the Girder server.":"An error occurred when resuming upload, check console.",this.trigger("g:upload.error",{message:b})},this))},a._multiChunkUpload=function(a){var b=this;this.eTagList={},this.startByte=0,this.chunkN=1,a.onload=function(){200===a.status?(b.s3UploadId=a.responseText.match(/<UploadId>(.*)<\/UploadId>/).pop(),b._sendNextChunk.call(b)):b.trigger("g:upload.error",{message:"Error while initializing multichunk S3 upload.",event:event})},a.addEventListener("error",function(a){b.trigger("g:upload.error",{message:"Error occurred uploading to S3.",event:a})}),a.send()},a._sendNextChunk=function(){var a=this.params.file.webkitSlice?"webkitSlice":"slice",b=this.params.file[a](this.startByte,this.startByte+this.params.upload.s3.chunkLength);this.payloadLength=b.size,girder.restRequest({path:"file/chunk",type:"POST",data:{offset:0,chunk:JSON.stringify({s3UploadId:this.s3UploadId,partNumber:this.chunkN}),uploadId:this.params.upload._id},error:null}).done(_.bind(function(a){var c=this,d=new XMLHttpRequest;d.open(a.s3.request.method,a.s3.request.url),d.onload=function(){200===d.status?(c.trigger("g:upload.chunkSent",{bytes:c.payloadLength}),c.eTagList[c.chunkN]=d.getResponseHeader("ETag").replace(/"/g,""),c.startByte+=c.payloadLength,c.chunkN+=1,c.startByte<c.params.file.size?c._sendNextChunk.call(c):c._finalizeMultiChunkUpload.call(c)):c.trigger("g:upload.error",{message:"Error occurred uploading to S3 ("+d.status+")."})},d.upload.addEventListener("progress",function(a){c._xhrProgress.call(c,a)}),d.addEventListener("error",function(a){c.trigger("g:upload.error",{message:"Error occurred uploading to S3.",event:a})}),d.send(b)},this)).error(_.bind(function(){this.trigger("g:upload.error",{message:"Error getting signed chunk request from girder."})},this))},a._finalizeMultiChunkUpload=function(){girder.restRequest({path:"file/completion",type:"POST",data:{uploadId:this.params.upload._id},error:null}).done(_.bind(function(a){var b=this,c=document.implementation.createDocument(null,null,null),d=c.createElement("CompleteMultipartUpload");_.each(this.eTagList,function(a,b){var e=c.createElement("Part"),f=c.createElement("PartNumber"),g=c.createElement("ETag");f.appendChild(c.createTextNode(b)),g.appendChild(c.createTextNode(a)),e.appendChild(f),e.appendChild(g),d.appendChild(e)
});var e=a.s3FinalizeRequest,f=new XMLHttpRequest;f.open(e.method,e.url),_.each(e.headers,function(a,b){f.setRequestHeader(b,a)}),f.onload=function(){200===f.status?b.trigger("g:upload.complete"):b.trigger("g:upload.error",{message:"Error occurred uploading to S3 ("+f.status+")."})},f.send((new window.XMLSerializer).serializeToString(d))},this)).error(_.bind(function(a){var b;b=0===a.status?"Could not connect to the server.":"Upload error during finalize, check console.",this.trigger("g:upload.error",{message:b})},this))}}(),girder.wrap=function(a,b,c){a.prototype[b]=_.wrap(a.prototype[b],c)},girder.Collection=Backbone.Collection.extend({resourceName:null,sortField:"name",sortDir:girder.SORT_ASC,comparator:girder.localeComparator,pageLimit:25,offset:0,altUrl:null,append:!1,hasPreviousPage:function(){return this.offset-this.length>0},hasNextPage:function(){return this._hasMorePages},fetchPreviousPage:function(a){this.offset=Math.max(0,this.offset-this.length-this.pageLimit),this.fetch(a)},fetchNextPage:function(a){this.fetch(_.extend(this.params,a||{}))},pageNum:function(){return Math.ceil((this.offset-this.length)/this.pageLimit)},fetch:function(a,b){return null===this.resourceName?void alert("Error: You must set a resourceName on your collection."):(b&&(this.offset=0),this.params=a||{},void girder.restRequest({path:this.altUrl||this.resourceName,data:_.extend({limit:this.pageLimit+1,offset:this.offset,sort:this.sortField,sortdir:this.sortDir},this.params)}).done(_.bind(function(a){a.length>this.pageLimit?(a.pop(),this._hasMorePages=!0):this._hasMorePages=!1,this.offset+=a.length,a.forEach(function(a){a.id=a._id}),(a.length>0||b)&&(this.append?this.add(a):this.set(a)),this.trigger("g:changed")},this)))}}),girder.Model=Backbone.Model.extend({resourceName:null,name:function(){return this.get("name")},save:function(){if(null===this.resourceName)return void alert("Error: You must set a resourceName on your model.");var a,b;this.has("_id")?(a=this.resourceName+"/"+this.get("_id"),b="PUT"):(a=this.resourceName,b="POST");var c={};_.each(this.attributes,function(a,b){"object"!=typeof a&&(c[b]=a)}),girder.restRequest({path:a,type:b,data:c,error:null}).done(_.bind(function(a){this.set(a),this.trigger("g:saved")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this))},fetch:function(){return null===this.resourceName?void alert("Error: You must set a resourceName on your model."):(girder.restRequest({path:this.resourceName+"/"+this.get("_id"),error:null}).done(_.bind(function(a){this.set(a),this.trigger("g:fetched")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this)),this)},download:function(){var a=girder.apiRoot+"/"+this.resourceName+"/"+this.get("_id")+"/download",b=girder.cookie.find("girderToken");b&&(a+="?token="+b),window.location.assign(a)},destroy:function(a){if(null===this.resourceName)return void alert("Error: You must set a resourceName on your model.");var b={path:this.resourceName+"/"+this.get("_id"),type:"DELETE"};return a=a||{},a.progress===!0&&(b.path+="?progress=true"),a.throwError!==!1&&(b.error=null),girder.restRequest(b).done(_.bind(function(){this.collection&&this.collection.remove(this),this.trigger("g:deleted")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this)),this},getAccessLevel:function(){return this.get("_accessLevel")}}),girder.AccessControlledModel=girder.Model.extend({updateAccess:function(){return null===this.resourceName?void alert("Error: You must set a resourceName on your model."):(girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/access",type:"PUT",data:{access:JSON.stringify(this.get("access")),"public":this.get("public")}}).done(_.bind(function(){this.trigger("g:accessListSaved")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this)),this)},fetchAccess:function(a){return null===this.resourceName?void alert("Error: You must set a resourceName on your model."):(!this.get("access")||a?girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/access",type:"GET"}).done(_.bind(function(a){a.access?this.set(a):this.set("access",a),this.trigger("g:accessFetched")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this)):this.trigger("g:accessFetched"),this)}}),girder.models.MetadataMixin={_sendMetadata:function(a,b,c){girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/metadata",contentType:"application/json",data:JSON.stringify(a),type:"PUT",error:null}).done(_.bind(function(a){this.set("meta",a.meta),b()},this)).error(_.bind(function(a){a.message=a.responseJSON.message,c(a)},this))},addMetadata:function(a,b,c,d){var e={};e[a]=b;var f=this.get("meta");return f&&_.has(f,a)?void d({message:a+" is already a metadata key"}):void this._sendMetadata(e,c,d)},removeMetadata:function(a,b,c){var d={};d[a]=null,this._sendMetadata(d,b,c)},editMetadata:function(a,b,c,d,e){if(a===b){var f={};f[a]=c,this._sendMetadata(f,d,e)}else{if(_.has(this.get("meta"),a))return void e({message:a+" is already a metadata key"});var g={};g[b]=null,g[a]=c,this._sendMetadata(g,d,e)}}},girder.View=Backbone.View.extend({}),girder.models.AssetstoreModel=girder.Model.extend({resourceName:"assetstore",capacityKnown:function(){var a=this.get("capacity");return a&&null!==a.free&&null!==a.total},capacityString:function(){if(!this.capacityKnown())return"Unknown";var a=this.get("capacity");return girder.formatSize(a.free)+" free of "+girder.formatSize(a.total)+" total"}}),girder.models.CollectionModel=girder.AccessControlledModel.extend({resourceName:"collection"}),girder.models.FileModel=girder.Model.extend({resourceName:"file",resumeInfo:null,updateContents:function(a){this.upload(null,a,{path:"file/"+this.get("_id")+"/contents",type:"PUT",data:{size:a.size}})},upload:function(a,b,c){this.startByte=0,this.resumeInfo=null,this.uploadHandler=null,c=c||{path:"file",type:"POST",data:{parentType:a.resourceName,parentId:a.get("_id"),name:b.name,size:b.size,mimeType:b.type}},girder.restRequest(c).done(_.bind(function(c){var d=c.behavior;return d&&girder.uploadHandlers[d]?(this.uploadHandler=new girder.uploadHandlers[d]({upload:c,parentModel:a,file:b}),this.uploadHandler.on({"g:upload.complete":function(a){this.trigger("g:upload.complete",a),this.uploadHandler=null},"g:upload.chunkSent":function(a){this.trigger("g:upload.chunkSent",a)},"g:upload.error":function(a){this.trigger("g:upload.error",a)},"g:upload.errorStarting":function(a){this.trigger("g:upload.errorStarting",a)},"g:upload.progress":function(a){this.trigger("g:upload.progress",{startByte:a.startByte,loaded:a.loaded,total:a.file.size,file:a.file})}},this),this.uploadHandler.execute()):void(b.size>0?this._uploadChunk(b,c._id):this.trigger("g:upload.complete"))},this)).error(_.bind(function(a){var b="Error: ";b+=0===a.status?"Connection to the server interrupted.":a.responseJSON.message,this.trigger("g:upload.errorStarting",{message:b})},this))},resumeUpload:function(){return null!==this.uploadHandler&&this.uploadHandler.resume?this.uploadHandler.resume():void girder.restRequest({path:"file/offset",type:"GET",data:{uploadId:this.resumeInfo.uploadId},error:null}).done(_.bind(function(a){this.startByte=a.offset,this._uploadChunk(this.resumeInfo.file,this.resumeInfo.uploadId)},this)).error(_.bind(function(a){var b;b=0===a.status?"Could not connect to the server.":"An error occurred when resuming upload, check console.",this.trigger("g:upload.error",{message:b})},this))},abortUpload:function(){this.resumeInfo&&this.resumeInfo.uploadId&&girder.restRequest({path:"system/uploads",type:"DELETE",data:{uploadId:this.resumeInfo.uploadId},error:null,done:null})},_uploadChunk:function(a,b){var c=Math.min(this.startByte+girder.UPLOAD_CHUNK_SIZE,a.size);this.chunkLength=c-this.startByte;var d=a.webkitSlice?"webkitSlice":"slice",e=a[d](this.startByte,c),f=this,g=new FormData;g.append("offset",this.startByte),g.append("uploadId",b),g.append("chunk",e),girder._uploadId=b,girder.restRequest({path:"file/chunk",type:"POST",dataType:"json",data:g,contentType:!1,processData:!1,success:function(){f.trigger("g:upload.chunkSent",{bytes:c-f.startByte}),c===a.size?(f.startByte=0,f.resumeInfo=null,f.trigger("g:upload.complete")):(f.startByte=c,f._uploadChunk(a,b))},error:function(c){var d="Error: ";d+=0===c.status?"Connection to the server interrupted.":c.responseJSON.message,f.resumeInfo={uploadId:b,file:a},f.trigger("g:upload.error",{message:d})},xhr:function(){var b=new window.XMLHttpRequest;return b.upload.addEventListener("progress",function(b){f._uploadProgress(a,b)}),b}})},_uploadProgress:function(a,b){if(b.lengthComputable){var c=this.chunkLength+b.loaded-b.total;c>=0&&this.trigger("g:upload.progress",{startByte:this.startByte,loaded:c,total:a.size,file:a})}}}),girder.models.FolderModel=girder.AccessControlledModel.extend({resourceName:"folder"}),_.extend(girder.models.FolderModel.prototype,girder.models.MetadataMixin),girder.models.GroupModel=girder.AccessControlledModel.extend({resourceName:"group",sendInvitation:function(a,b,c){girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/invitation",data:{userId:a,level:b},type:"POST",error:null}).done(_.bind(function(d){this.set(d),c||a!==girder.currentUser.get("_id")||girder.currentUser.addInvitation(this.get("_id"),b),this.trigger("g:invited")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this))},joinGroup:function(){girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/member",type:"POST"}).done(_.bind(function(a){girder.currentUser.addToGroup(this.get("_id")),girder.currentUser.removeInvitation(this.get("_id")),this.set(a),this.trigger("g:joined")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this))},requestInvitation:function(){girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/member",type:"POST"}).done(_.bind(function(a){this.set(a),this.trigger("g:inviteRequested")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this))},promoteUser:function(a,b){var c;b===girder.AccessType.WRITE?c="moderator":b===girder.AccessType.ADMIN&&(c="admin"),girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/"+c,data:{userId:a.get("_id")},type:"POST"}).done(_.bind(function(a){this.set(a),this.trigger("g:promoted")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this))},demoteUser:function(a,b){var c;b===girder.AccessType.WRITE?c="moderator":b===girder.AccessType.ADMIN&&(c="admin"),girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/"+c+"?userId="+a,type:"DELETE"}).done(_.bind(function(a){this.set(a),this.trigger("g:demoted")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this))},removeMember:function(a){girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/member?userId="+a,type:"DELETE"}).done(_.bind(function(b){a===girder.currentUser.get("_id")&&girder.currentUser.removeFromGroup(this.get("_id")),this.set(b),this.trigger("g:removed")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this))}}),girder.models.ItemModel=girder.Model.extend({resourceName:"item",getAccessLevel:function(a){this.parent&&this.parent.getAccessLevel()?a(this.parent.getAccessLevel()):(this.parent=new girder.models.FolderModel,this.parent.set({_id:this.get("folderId")}).on("g:fetched",function(){a(this.parent.getAccessLevel())},this).fetch())},getRootPath:function(a){girder.restRequest({path:this.resourceName+"/"+this.get("_id")+"/rootpath"}).done(_.bind(function(b){a(b)},this)).error(_.bind(function(a){this.trigger("g:error",a)},this))}}),_.extend(girder.models.ItemModel.prototype,girder.models.MetadataMixin),girder.models.UserModel=girder.Model.extend({resourceName:"user",name:function(){return this.get("firstName")+" "+this.get("lastName")},addToGroup:function(a){var b=this.get("groups")||[];b.push(a),this.set("groups",b)},removeFromGroup:function(a){for(var b=this.get("groups")||[],c=b.indexOf(a);c>=0;)b.splice(c,1),c=b.indexOf(a);this.set("groups",b)},addInvitation:function(a,b){var c=this.get("groupInvites")||[];c.push({groupId:a,level:b}),this.set("groupInvites",c)},removeInvitation:function(a){var b=this.get("groupInvites")||[],c=[];_.each(b,function(b){b.groupId!==a&&c.push(b)},this),this.set("groupInvites",c)},changePassword:function(a,b){girder.restRequest({path:this.resourceName+"/password",data:{old:a,"new":b},type:"PUT",error:null}).done(_.bind(function(){this.trigger("g:passwordChanged")},this)).error(_.bind(function(a){this.trigger("g:error",a)},this))}}),girder.collections.AssetstoreCollection=girder.Collection.extend({resourceName:"assetstore",model:girder.models.AssetstoreModel}),girder.collections.CollectionCollection=girder.Collection.extend({resourceName:"collection",model:girder.models.CollectionModel}),girder.collections.FileCollection=girder.Collection.extend({resourceName:"file",model:girder.models.FileModel,pageLimit:100}),girder.collections.FolderCollection=girder.Collection.extend({resourceName:"folder",model:girder.models.FolderModel,pageLimit:100}),girder.collections.GroupCollection=girder.Collection.extend({resourceName:"group",model:girder.models.GroupModel}),girder.collections.ItemCollection=girder.Collection.extend({resourceName:"item",model:girder.models.ItemModel,pageLimit:100}),girder.collections.UserCollection=girder.Collection.extend({resourceName:"user",model:girder.models.UserModel,sortField:"lastName",secondarySortField:"firstName"}),girder.views.AdminView=girder.View.extend({events:{"click .g-server-config":function(){girder.router.navigate("settings",{trigger:!0})},"click .g-assetstore-config":function(){girder.router.navigate("assetstores",{trigger:!0})},"click .g-plugins-config":function(){girder.router.navigate("plugins",{trigger:!0})}},initialize:function(){this.render()},render:function(){return girder.currentUser&&girder.currentUser.get("admin")?(this.$el.html(jade.templates.adminConsole()),this):void this.$el.text("Must be logged in as admin to view this page.")}}),girder.router.route("admin","admin",function(){girder.events.trigger("g:navigateTo",girder.views.AdminView)}),girder.views.AssetstoresView=girder.View.extend({events:{"click .g-set-current":"setCurrentAssetstore","click .g-delete-assetstore":"deleteAssetstore","click .g-edit-assetstore":"editAssetstore"},initialize:function(){girder.currentUser&&girder.currentUser.get("admin")?(this.collection=new girder.collections.AssetstoreCollection,this.collection.on("g:changed",function(){this.render()},this).fetch()):this.render()},render:function(){return girder.currentUser&&girder.currentUser.get("admin")?(this.$el.html(jade.templates.assetstores({assetstores:this.collection.models,types:girder.AssetstoreType})),this.newAssetstoreWidget=new girder.views.NewAssetstoreWidget({el:this.$("#g-new-assetstore-container")}),this.newAssetstoreWidget.off().on("g:created",this.addAssetstore,this).render(),this.$(".g-assetstore-button-container[title]").tooltip(),_.each(this.$(".g-assetstore-capacity-chart"),this.capacityChart,this),this):void this.$el.text("Must be logged in as admin to view this page.")},addAssetstore:function(a){this.collection.add(a),this.render()},capacityChart:function(a){{var b=this.collection.get($(a).attr("cid")),c=b.get("capacity"),d=[["Free",c.free],["Used",c.total-c.free]];$(a).jqplot([d],{seriesDefaults:{renderer:$.jqplot.PieRenderer,rendererOptions:{sliceMargin:2,shadow:!1,highlightMouseOver:!1}},legend:{show:!0,location:"e",background:"transparent",border:"none"},grid:{background:"transparent",border:"none",borderWidth:0,shadow:!1}})}},setCurrentAssetstore:function(a){var b=$(a.currentTarget),c=this.collection.get(b.attr("cid"));c.set({current:!0}),c.off("g:saved").on("g:saved",function(){girder.events.trigger("g:alert",{icon:"ok",text:"Changed current assetstore.",type:"success",timeout:4e3}),this.collection.fetch({},!0)},this).save()},deleteAssetstore:function(a){var b=$(a.currentTarget),c=this.collection.get(b.attr("cid"));girder.confirm({text:"Are you sure you want to delete the assetstore <b>"+c.escape("name")+"</b>?  There are no files stored in it, and no data will be lost.",escapedHtml:!0,yesText:"Delete",confirmCallback:_.bind(function(){c.on("g:deleted",function(){girder.events.trigger("g:alert",{icon:"ok",text:"Assetstore deleted.",type:"success",timeout:4e3}),this.collection.fetch({},!0)},this).off("g:error").on("g:error",function(a){girder.events.trigger("g:alert",{icon:"attention",text:a.responseJSON.message,type:"danger",timeout:4e3})},this).destroy()},this)})},editAssetstore:function(a){var b=$(a.currentTarget),c=this.collection.get(b.attr("cid")),d=$("#g-dialog-container"),e=new girder.views.EditAssetstoreWidget({el:d,model:c}).off("g:saved").on("g:saved",function(){this.render()},this);e.render()}}),girder.router.route("assetstores","assetstores",function(){girder.events.trigger("g:navigateTo",girder.views.AssetstoresView)}),function(){girder.views.CollectionView=girder.View.extend({events:{"click .g-edit-collection":"editCollection","click .g-collection-access-control":"editAccess","click .g-delete-collection":function(){girder.confirm({text:"Are you sure you want to delete the collection <b>"+this.model.escape("name")+"</b>?",yesText:"Delete",escapedHtml:!0,confirmCallback:_.bind(function(){this.model.destroy().on("g:deleted",function(){girder.events.trigger("g:alert",{icon:"ok",text:"Collection deleted.",type:"success",timeout:4e3}),girder.router.navigate("collections",{trigger:!0})})},this)})}},initialize:function(a){this.upload=a.upload||!1,this.access=a.access||!1,this.edit=a.edit||!1,this.folderAccess=a.folderAccess||!1,this.folderCreate=a.folderCreate||!1,this.folderEdit=a.folderEdit||!1,this.itemCreate=a.itemCreate||!1,a.collection?(this.model=a.collection,a.folderId?(this.folder=new girder.models.FolderModel,this.folder.set({_id:a.folderId}).on("g:fetched",function(){this.render()},this).on("g:error",function(){this.folder=null,this.render()},this).fetch()):this.render()):a.id&&(this.model=new girder.models.CollectionModel,this.model.set("_id",a.id),this.model.on("g:fetched",function(){this.render()},this).fetch())},editCollection:function(){var a=$("#g-dialog-container");this.editCollectionWidget||(this.editCollectionWidget=new girder.views.EditCollectionWidget({el:a,model:this.model}).off("g:saved").on("g:saved",function(){this.render()},this)),this.editCollectionWidget.render()},render:function(){return this.$el.html(jade.templates.collectionPage({collection:this.model,girder:girder})),this.hierarchyWidget=new girder.views.HierarchyWidget({parentModel:this.folder||this.model,upload:this.upload,folderAccess:this.folderAccess,folderEdit:this.folderEdit,folderCreate:this.folderCreate,itemCreate:this.itemCreate,el:this.$(".g-collection-hierarchy-container")}),this.upload=!1,this.folderAccess=!1,this.folderEdit=!1,this.folderCreate=!1,this.itemCreate=!1,this.$(".g-collection-actions-button").tooltip({container:"body",placement:"left",animation:!1,delay:{show:100}}),this.edit?this.editCollection():this.access&&this.editAccess(),this},editAccess:function(){new girder.views.AccessWidget({el:$("#g-dialog-container"),modelType:"collection",model:this.model}).on("g:saved",function(){},this)}});var a=function(a,b){var c=new girder.models.CollectionModel;c.set({_id:a}).on("g:fetched",function(){girder.events.trigger("g:navigateTo",girder.views.CollectionView,_.extend({collection:c},b||{}))},this).on("g:error",function(){girder.router.navigate("/collections",{trigger:!0})},this).fetch()};girder.router.route("collection/:id","collectionAccess",function(b,c){a(b,{access:"access"===c.dialog,edit:"edit"===c.dialog})}),girder.router.route("collection/:id/folder/:id","collectionFolder",function(b,c,d){a(b,{folderId:c,upload:"upload"===d.dialog,access:"access"===d.dialog,edit:"edit"===d.dialog,folderAccess:"folderaccess"===d.dialog,folderCreate:"foldercreate"===d.dialog,folderEdit:"folderedit"===d.dialog,itemCreate:"itemcreate"===d.dialog})})}(),girder.views.CollectionsView=girder.View.extend({events:{"click a.g-collection-link":function(a){var b=$(a.currentTarget).attr("g-collection-cid");girder.router.navigate("collection/"+this.collection.get(b).id,{trigger:!0})},"click button.g-collection-create-button":function(){this.createCollectionDialog()},"submit .g-collections-search-form":function(a){a.preventDefault()}},initialize:function(a){this.collection=new girder.collections.CollectionCollection,this.collection.on("g:changed",function(){this.render()},this).fetch(),this.create="create"===a.dialog},createCollectionDialog:function(){var a=$("#g-dialog-container");new girder.views.EditCollectionWidget({el:a}).off("g:saved").on("g:saved",function(a){girder.router.navigate("collection/"+a.get("_id"),{trigger:!0})},this).render()},render:function(){return this.$el.html(jade.templates.collectionList({collections:this.collection.models,girder:girder})),new girder.views.PaginateWidget({el:this.$(".g-collection-pagination"),collection:this.collection}).render(),new girder.views.SearchFieldWidget({el:this.$(".g-collections-search-container"),placeholder:"Search collections...",types:["collection"]}).off().on("g:resultClicked",this._gotoCollection,this).render(),this.create&&this.createCollectionDialog(),this},_gotoCollection:function(a){var b=new girder.models.CollectionModel;b.set("_id",a.id).on("g:fetched",function(){girder.router.navigate("/collection/"+b.get("_id"),{trigger:!0})},this).fetch()}}),girder.router.route("collections","collections",function(a){girder.events.trigger("g:navigateTo",girder.views.CollectionsView,a||{}),girder.events.trigger("g:highlightItem","CollectionsView")}),girder.views.FolderView=girder.View.extend({initialize:function(a){this.folder=a.folder,this.upload=a.upload||!1,this.folderAccess=a.folderAccess||!1,this.folderCreate=a.folderCreate||!1,this.folderEdit=a.folderEdit||!1,this.itemCreate=a.itemCreate||!1,this.render()},render:function(){return this.hierarchyWidget=new girder.views.HierarchyWidget({parentModel:this.folder,upload:this.upload,folderAccess:this.folderAccess,folderEdit:this.folderEdit,folderCreate:this.folderCreate,itemCreate:this.itemCreate,el:this.$el}),this.upload=!1,this.folderAccess=!1,this.folderEdit=!1,this.folderCreate=!1,this.itemCreate=!1,this}}),girder.router.route("folder/:id","folder",function(a,b){var c=new girder.models.FolderModel;c.set({_id:a}).on("g:fetched",function(){girder.events.trigger("g:navigateTo",girder.views.FolderView,_.extend({folder:c,upload:"upload"===b.dialog,folderAccess:"folderaccess"===b.dialog,folderCreate:"foldercreate"===b.dialog,folderEdit:"folderedit"===b.dialog,itemCreate:"itemcreate"===b.dialog},b||{}))},this).on("g:error",function(){girder.router.navigate("collections",{trigger:!0})},this).fetch()}),girder.views.FrontPageView=girder.View.extend({events:{"click .g-register-link":function(){girder.events.trigger("g:registerUi")},"click .g-login-link":function(){girder.events.trigger("g:loginUi")},"click .g-collections-link":function(){girder.router.navigate("collections",{trigger:!0})},"click .g-quicksearch-link":function(){$(".g-quick-search-container .g-search-field").focus()},"click .g-my-account-link":function(){girder.router.navigate("useraccount/"+girder.currentUser.get("_id")+"/info",{trigger:!0})},"click .g-my-folders-link":function(){girder.router.navigate("user/"+girder.currentUser.get("_id"),{trigger:!0})}},initialize:function(){this.render()},render:function(){return this.$el.html(jade.templates.frontPage({apiRoot:girder.apiRoot,staticRoot:girder.staticRoot,currentUser:girder.currentUser,versionInfo:girder.versionInfo})),this}}),girder.router.route("","index",function(){girder.events.trigger("g:navigateTo",girder.views.FrontPageView)}),function(){girder.views.GroupView=girder.View.extend({events:{"click .g-edit-group":"editGroup","click .g-group-join":"joinGroup","click .g-group-leave":"leaveGroup","click .g-group-delete":"deleteGroup","click .g-group-request-invite":"requestInvitation","click .g-group-request-accept":"acceptMembershipRequest","click .g-group-request-deny":"denyMembershipRequest","click #g-group-tab-pending a.g-member-name":function(a){var b=$(a.currentTarget).parents("li").attr("userid");girder.router.navigate("user/"+b,{trigger:!0})}},initialize:function(a){this.tab=a.tab||"roles",this.edit=a.edit||!1,a.group?(this.model=a.group,this.model.on("g:accessFetched",function(){this.render()},this).fetchAccess()):a.id&&(this.model=new girder.models.GroupModel,this.model.set("_id",a.id),this.model.on("g:fetched",function(){this.model.on("g:accessFetched",function(){this.render()},this).fetchAccess()},this).fetch())},editGroup:function(){var a=$("#g-dialog-container");this.editGroupWidget||(this.editGroupWidget=new girder.views.EditGroupWidget({el:a,model:this.model}).off("g:saved").on("g:saved",function(){this.render()},this)),this.editGroupWidget.render()},deleteGroup:function(){var a=this;girder.confirm({text:"Are you sure you want to delete the group <b>"+a.model.escape("name")+"</b>?",escapedHtml:!0,confirmCallback:function(){a.model.on("g:deleted",function(){girder.router.navigate("groups",{trigger:!0})}).destroy()}})},render:function(){if(this.isMember=!1,this.isInvited=!1,this.isRequested=!1,girder.currentUser&&(_.every(girder.currentUser.get("groups"),function(a){return a===this.model.get("_id")?(this.isMember=!0,!1):!0},this),_.every(girder.currentUser.get("groupInvites"),function(a){return a.groupId===this.model.get("_id")?(this.isInvited=!0,!1):!0},this),_.every(this.model.get("requests")||[],function(a){return a.id===girder.currentUser.get("_id")?(this.isRequested=!0,!1):!0},this)),this.$el.html(jade.templates.groupPage({group:this.model,girder:girder,isInvited:this.isInvited,isRequested:this.isRequested,isMember:this.isMember})),this.invitees)new girder.views.GroupInvitesWidget({el:this.$(".g-group-invites-body"),invitees:this.invitees,group:this.model}).render();else{var a=this.$(".g-group-invites-body");new girder.views.LoadingAnimation({el:a}).render(),this.invitees=new girder.collections.UserCollection,this.invitees.altUrl="group/"+this.model.get("_id")+"/invitation",this.invitees.on("g:changed",function(){this.render()},this).fetch()}return this.membersWidget=new girder.views.GroupMembersWidget({el:this.$(".g-group-members-container"),group:this.model,parent:this}).off().on("g:sendInvite",function(a){this.model.off("g:invited").on("g:invited",function(){this.invitees.fetch(null,!0)},this).off("g:error").on("g:error",function(a){alert(a.responseJSON.message)},this).sendInvitation(a.user.id,a.level)},this).on("g:removeMember",this.removeMember,this).on("g:moderatorAdded",function(){this._updateRolesLists()},this).on("g:adminAdded",function(){this._updateRolesLists()},this),this._updateRolesLists(),this.$(".g-group-actions-button,a[title]").tooltip({container:this.$el,placement:"left",animation:!1,delay:{show:100}}),girder.router.navigate("group/"+this.model.get("_id")+"/"+this.tab,{replace:!0}),this.edit&&(this.editGroup(),this.edit=!1),_.each($(".g-group-tabs>li>a"),function(a){var b=$(a),c=this;b.tab().on("shown.bs.tab",function(a){c.tab=$(a.currentTarget).attr("name"),girder.router.navigate("group/"+c.model.get("_id")+"/"+c.tab)}),b.attr("name")===this.tab&&b.tab("show")},this),this},joinGroup:function(){this.model.off("g:joined").on("g:joined",function(){this.invitees.fetch(null,!0)},this).joinGroup()},leaveGroup:function(){var a=this;girder.confirm({text:"Are you sure you want to leave this group?",confirmCallback:function(){a.model.off("g:removed").on("g:removed",function(){a.render()}).removeMember(girder.currentUser.get("_id"))}})},removeMember:function(a){this.model.off("g:removed").on("g:removed",function(){this.render()},this).removeMember(a.get("_id"))},requestInvitation:function(){this.model.off("g:inviteRequested").on("g:inviteRequested",function(){this.render()},this).requestInvitation()},acceptMembershipRequest:function(a){var b=$(a.currentTarget).parents("li").attr("userid");this.model.off("g:invited").on("g:invited",this.render,this).sendInvitation(b,girder.AccessType.READ,!0)},denyMembershipRequest:function(a){var b=$(a.currentTarget).parents("li").attr("userid");this.model.off("g:removed").on("g:removed",this.render,this).removeMember(b)},_updateRolesLists:function(){var a=[],b=[];_.each(this.model.get("access").users,function(c){c.level===girder.AccessType.WRITE?a.push(c):c.level===girder.AccessType.ADMIN&&b.push(c)},this),this.modsWidget=new girder.views.GroupModsWidget({el:this.$(".g-group-mods-container"),group:this.model,moderators:a,parent:this}).off().on("g:demoteUser",function(a){this.model.off("g:demoted").on("g:demoted",this.render,this).demoteUser(a,girder.AccessType.WRITE)},this).render(),this.adminsWidget=new girder.views.GroupAdminsWidget({el:this.$(".g-group-admins-container"),group:this.model,admins:b,parent:this}).off().on("g:demoteUser",function(a){this.model.off("g:demoted").on("g:demoted",this.render,this).demoteUser(a,girder.AccessType.ADMIN)},this).render()}});var a=function(a,b){var c=new girder.models.GroupModel;c.set({_id:a}).on("g:fetched",function(){girder.events.trigger("g:navigateTo",girder.views.GroupView,_.extend({group:c},b||{}))},this).on("g:error",function(){girder.router.navigate("/groups",{trigger:!0})},this).fetch()};girder.router.route("group/:id","groupView",function(b,c){a(b,{edit:"edit"===c.dialog})}),girder.router.route("group/:id/:tab","groupView",function(b,c,d){a(b,{edit:"edit"===d.dialog,tab:c})})}(),girder.views.GroupsView=girder.View.extend({events:{"click a.g-group-link":function(a){var b=$(a.currentTarget).attr("g-group-cid");girder.router.navigate("group/"+this.collection.get(b).id,{trigger:!0})},"submit .g-group-search-form":function(a){a.preventDefault()},"click .g-group-create-button":function(){this.createGroupDialog()}},initialize:function(a){this.collection=new girder.collections.GroupCollection,this.collection.on("g:changed",function(){this.render()},this).fetch(),this.create="create"===a.dialog},render:function(){return this.$el.html(jade.templates.groupList({groups:this.collection.models,girder:girder})),new girder.views.PaginateWidget({el:this.$(".g-group-pagination"),collection:this.collection}).render(),new girder.views.SearchFieldWidget({el:this.$(".g-groups-search-container"),placeholder:"Search groups...",types:["group"]}).off().on("g:resultClicked",this._gotoGroup,this).render(),this.create&&(this.createGroupDialog(),this.create=!1),this},createGroupDialog:function(){new girder.views.EditGroupWidget({el:$("#g-dialog-container")}).off("g:saved").on("g:saved",function(a){var b=girder.currentUser.get("groups")||[];b.push(a.get("_id")),girder.currentUser.set("groups",b),girder.router.navigate("group/"+a.get("_id"),{trigger:!0})},this).render()},_gotoGroup:function(a){var b=new girder.models.GroupModel;b.set("_id",a.id).on("g:fetched",function(){girder.router.navigate("group/"+b.get("_id"),{trigger:!0})},this).fetch()}}),girder.router.route("groups","groups",function(a){girder.events.trigger("g:navigateTo",girder.views.GroupsView,a||{}),girder.events.trigger("g:highlightItem","GroupsView")}),function(){girder.views.ItemView=girder.View.extend({events:{"click .g-download-item":function(){this.model.download()},"click .g-edit-item":"editItem","click .g-delete-item":"deleteItem"},initialize:function(a){this.edit=a.edit||!1,a.item?(this.model=a.item,this.render()):console.error("Implement fetch then render item")},editItem:function(){var a=$("#g-dialog-container");this.editItemWidget||(this.editItemWidget=new girder.views.EditItemWidget({el:a,item:this.model}).off("g:saved").on("g:saved",function(){this.edit=!1,this.render()},this)),this.editItemWidget.render()},deleteItem:function(){var a=this.model.get("folderId"),b=this.model.get("baseParentType")+"/"+this.model.get("baseParentId")+"/folder/"+a,c=this;girder.confirm({text:"Are you sure you want to delete <b>"+this.model.escape("name")+"</b>?",yesText:"Delete",escapedHtml:!0,confirmCallback:_.bind(function(){this.model.destroy().on("g:deleted",function(){girder.router.navigate(b,{trigger:!0})
}).off("g:error").on("g:error",function(){c.render(),girder.events.trigger("g:alert",{icon:"info",text:"Failed to delete item.",type:"warning",timeout:4e3})})},this)})},render:function(){return this.model.getAccessLevel(_.bind(function(a){this.$el.html(jade.templates.itemPage({item:this.model,accessLevel:a,girder:girder})),this.$(".g-item-actions-button").tooltip({container:"body",placement:"left",animation:!1,delay:{show:100}}),this.fileListWidget=new girder.views.FileListWidget({el:this.$(".g-item-files-container"),itemId:this.model.get("_id")}),this.metadataWidget=new girder.views.MetadataWidget({el:this.$(".g-item-metadata"),item:this.model,accessLevel:a,girder:girder}),this.model.getRootPath(_.bind(function(a){this.breadcrumbWidget=new girder.views.ItemBreadcrumbWidget({el:this.$(".g-item-breadcrumb-container"),parentChain:a})},this)),this.edit&&this.editItem()},this)),this}});var a=function(a,b){var c=new girder.models.ItemModel;c.set({_id:a}).on("g:fetched",function(){girder.events.trigger("g:navigateTo",girder.views.ItemView,_.extend({item:c},b||{}))},this).on("g:error",function(){girder.router.navigate("collections",{trigger:!0})},this).fetch()};girder.router.route("item/:id","item",function(b,c){a(b,{edit:"itemedit"===c.dialog})})}(),girder.views.PluginsView=girder.View.extend({events:{"click a.g-plugin-config-link":function(a){var b=$(a.currentTarget).attr("g-route");girder.router.navigate(b,{trigger:!0})}},initialize:function(a){a.all&&a.enabled?(this.enabled=a.enabled,this.allPlugins=a.all,this.render()):girder.restRequest({path:"system/plugins",type:"GET"}).done(_.bind(function(a){this.enabled=a.enabled,this.allPlugins=a.all,this.render()},this))},render:function(){_.each(this.allPlugins,function(a,b){this.enabled.indexOf(b)>=0&&(a.enabled=!0,a.configRoute=girder.getPluginConfigRoute(b))},this),this.$el.html(jade.templates.plugins({allPlugins:this.allPlugins}));var a=this;return this.$(".g-plugin-switch").bootstrapSwitch().off("switchChange.bootstrapSwitch").on("switchChange.bootstrapSwitch",function(b,c){var d=$(b.currentTarget).attr("key");if(c===!0)a.enabled.push(d);else for(var e;(e=a.enabled.indexOf(d))>=0;)a.enabled.splice(e,1);a._updatePlugins()}),this.$(".g-plugin-config-link").tooltip({container:this.$el,animation:!1,placement:"bottom",delay:{show:100}}),this},_updatePlugins:function(){girder.restRequest({path:"system/plugins",type:"PUT",data:{plugins:JSON.stringify(this.enabled)}}).done(_.bind(function(){},this)).error(_.bind(function(){},this))}}),girder.router.route("plugins","plugins",function(){girder.restRequest({path:"system/plugins",type:"GET"}).done(_.bind(function(a){girder.events.trigger("g:navigateTo",girder.views.PluginsView,a)},this)).error(_.bind(function(){girder.events.trigger("g:navigateTo",girder.views.UsersView)},this))}),girder.views.SystemConfigurationView=girder.View.extend({events:{"submit .g-settings-form":function(a){a.preventDefault(),this.$(".g-submit-settings").addClass("disabled"),this.$("#g-settings-error-message").empty();for(var b=[],c=0;c<this.settingsKeys.length;c+=1)b.push({key:this.settingsKeys[c],value:$("#g-"+this.settingsKeys[c].replace(/[_.]/g,"-")).val()||null});girder.restRequest({type:"PUT",path:"system/setting",data:{list:JSON.stringify(b)},error:null}).done(_.bind(function(){this.$(".g-submit-settings").removeClass("disabled"),girder.events.trigger("g:alert",{icon:"ok",text:"Settings saved.",type:"success",timeout:4e3})},this)).error(_.bind(function(a){this.$(".g-submit-settings").removeClass("disabled"),this.$("#g-settings-error-message").text(a.responseJSON.message)},this))}},initialize:function(){var a=["core.cookie_lifetime","core.email_from_address","core.registration_policy","core.smtp_host","core.upload_minimum_chunk_size"];this.settingsKeys=a,girder.restRequest({path:"system/setting",type:"GET",data:{list:JSON.stringify(a),"default":"none"}}).done(_.bind(function(b){this.settings=b,girder.restRequest({path:"system/setting",type:"GET",data:{list:JSON.stringify(a),"default":"default"}}).done(_.bind(function(a){this.defaults=a,this.render()},this))},this))},render:function(){return this.$el.html(jade.templates.systemConfiguration({settings:this.settings,defaults:this.defaults})),this.$("input[title]").tooltip({container:this.$el,animation:!1,delay:{show:200}}),null!==this.settings["core.registration_policy"]&&this.$("#g-core-registration-policy").val(this.settings["core.registration_policy"]),this}}),girder.router.route("settings","settings",function(){girder.events.trigger("g:navigateTo",girder.views.SystemConfigurationView)}),girder.views.UserAccountView=girder.View.extend({events:{"submit #g-user-info-form":function(a){a.preventDefault(),this.$("#g-user-info-error-msg").empty();var b={email:this.$("#g-email").val(),firstName:this.$("#g-firstName").val(),lastName:this.$("#g-lastName").val()};this.$("#g-admin").length>0&&(b.admin=this.$("#g-admin").is(":checked")),this.user.set(b),this.user.off("g:error").on("g:error",function(a){var b=a.responseJSON.message;this.$("#g-"+a.responseJSON.field).focus(),this.$("#g-user-info-error-msg").text(b)},this).off("g:saved").on("g:saved",function(){girder.events.trigger("g:alert",{icon:"ok",text:"Info saved.",type:"success",timeout:4e3})},this).save()},"submit #g-password-change-form":function(a){return a.preventDefault(),this.$("#g-password-change-error-msg").empty(),this.$("#g-password-new").val()!==this.$("#g-password-retype").val()?(this.$("#g-password-change-error-msg").text("Passwords do not match, try again."),this.$("#g-password-retype,#g-password-new").val(""),void this.$("#g-password-new").focus()):void this.user.off("g:error").on("g:error",function(a){var b=a.responseJSON.message;this.$("#g-password-change-error-msg").text(b)},this).off("g:passwordChanged").on("g:passwordChanged",function(){girder.events.trigger("g:alert",{icon:"ok",text:"Password changed.",type:"success",timeout:4e3}),this.$("#g-password-old,#g-password-new,#g-password-retype").val("")},this).changePassword(this.$("#g-password-old").val(),this.$("#g-password-new").val())}},initialize:function(a){return this.tab=a.tab||"info",this.user=a.user||girder.currentUser,this.isCurrentUser=girder.currentUser&&a.user.get("_id")===girder.currentUser.get("_id"),this.model=this.user,!this.user||this.user.getAccessLevel()<girder.AccessType.WRITE?void girder.router.navigate("users",{trigger:!0}):(this.render(),void girder.events.on("g:login",this.userChanged,this))},render:function(){return null===girder.currentUser?void girder.router.navigate("users",{trigger:!0}):(this.$el.html(jade.templates.userSettings({user:this.model,girder:girder})),_.each($(".g-account-tabs>li>a"),function(a){var b=$(a),c=this;b.tab().on("shown.bs.tab",function(a){c.tab=$(a.currentTarget).attr("name"),girder.router.navigate("useraccount/"+c.model.get("_id")+"/"+c.tab)}),b.attr("name")===this.tab&&b.tab("show")},this),this)},userChanged:function(){this.model.off("g:fetched").on("g:fetched",function(){this.render()},this).on("g:error",function(){girder.router.navigate("users",{trigger:!0})},this).fetch()}}),girder.router.route("useraccount/:id/:tab","accountTab",function(a,b){var c=new girder.models.UserModel;c.set({_id:a}).on("g:fetched",function(){girder.events.trigger("g:navigateTo",girder.views.UserAccountView,{user:c,tab:b})},this).on("g:error",function(){girder.router.navigate("users",{trigger:!0})},this).fetch()}),function(){girder.views.UserView=girder.View.extend({events:{"click a.g-edit-user":function(){var a="useraccount/"+this.model.get("_id")+"/info";girder.router.navigate(a,{trigger:!0})},"click a.g-delete-user":function(){girder.confirm({text:"Are you sure you want to delete the user <b>"+this.model.escape("login")+"</b>?",yesText:"Delete",escapedHtml:!0,confirmCallback:_.bind(function(){this.model.destroy().on("g:deleted",function(){girder.router.navigate("users",{trigger:!0})})},this)})}},initialize:function(a){this.folderId=a.folderId||null,this.upload=a.upload||!1,this.folderAccess=a.folderAccess||!1,this.folderCreate=a.folderCreate||!1,this.folderEdit=a.folderEdit||!1,this.itemCreate=a.itemCreate||!1,a.user?(this.model=a.user,a.folderId?(this.folder=new girder.models.FolderModel,this.folder.set({_id:a.folderId}).on("g:fetched",function(){this.render()},this).on("g:error",function(){this.folder=null,this.render()},this).fetch()):this.render()):a.id&&(this.model=new girder.models.UserModel,this.model.set("_id",a.id),this.model.on("g:fetched",function(){this.render()},this).fetch())},render:function(){return this.$el.html(jade.templates.userPage({user:this.model,girder:girder})),this.hierarchyWidget=new girder.views.HierarchyWidget({parentModel:this.folder||this.model,el:this.$(".g-user-hierarchy-container"),upload:this.upload,folderAccess:this.folderAccess,folderEdit:this.folderEdit,folderCreate:this.folderCreate,itemCreate:this.itemCreate}),this.upload=!1,this.folderAccess=!1,this.folderEdit=!1,this.folderCreate=!1,this.itemCreate=!1,this}});var a=function(a,b){var c=new girder.models.UserModel;c.set({_id:a}).on("g:fetched",function(){girder.events.trigger("g:navigateTo",girder.views.UserView,_.extend({user:c},b||{}))},this).on("g:error",function(){girder.events.trigger("g:navigateTo",girder.views.UsersView)},this).fetch()};girder.router.route("user/:id","user",function(b,c){a(b,{folderCreate:"foldercreate"===c.dialog})}),girder.router.route("user/:id/folder/:id","userFolder",function(b,c,d){a(b,{folderId:c,upload:"upload"===d.dialog,folderAccess:"folderaccess"===d.dialog,folderCreate:"foldercreate"===d.dialog,folderEdit:"folderedit"===d.dialog,itemCreate:"itemcreate"===d.dialog})})}(),girder.views.UsersView=girder.View.extend({events:{"click a.g-user-link":function(a){{var b=$(a.currentTarget).attr("g-user-cid");({user:this.collection.get(b)})}girder.router.navigate("user/"+this.collection.get(b).id,{trigger:!0})},"submit .g-user-search-form":function(a){a.preventDefault()}},initialize:function(){this.collection=new girder.collections.UserCollection,this.collection.on("g:changed",function(){this.render()},this).fetch()},render:function(){return this.$el.html(jade.templates.userList({users:this.collection.models,girder:girder})),new girder.views.PaginateWidget({el:this.$(".g-user-pagination"),collection:this.collection}).render(),new girder.views.SearchFieldWidget({el:this.$(".g-users-search-container"),placeholder:"Search users...",types:["user"]}).off().on("g:resultClicked",this._gotoUser,this).render(),this},_gotoUser:function(a){var b=new girder.models.UserModel;b.set("_id",a.id).on("g:fetched",function(){girder.router.navigate("user/"+b.get("_id"),{trigger:!0})},this).fetch()}}),girder.router.route("users","users",function(){girder.events.trigger("g:navigateTo",girder.views.UsersView),girder.events.trigger("g:highlightItem","UsersView")}),girder.views.LayoutFooterView=girder.View.extend({render:function(){return this.$el.html(jade.templates.layoutFooter({apiRoot:girder.apiRoot})),this}}),girder.views.LayoutGlobalNavView=girder.View.extend({events:{"click .g-nav-link":function(a){var b=$(a.currentTarget);girder.router.navigate(b.attr("g-target"),{trigger:!0}),b.parent().addClass("g-active")}},initialize:function(){girder.events.on("g:highlightItem",this.selectForView,this),girder.events.on("g:login",this.render,this)},render:function(){var a=[{name:"Collections",icon:"icon-sitemap",target:"collections"},{name:"Users",icon:"icon-user",target:"users"},{name:"Groups",icon:"icon-users",target:"groups"}];return girder.currentUser&&girder.currentUser.get("admin")&&a.push({name:"Admin console",icon:"icon-wrench",target:"admin"}),this.$el.html(jade.templates.layoutGlobalNav({navItems:a})),Backbone.history.fragment&&this.$('[g-target="'+Backbone.history.fragment+'"]').parent().addClass("g-active"),this},selectForView:function(a){this.deactivateAll(),this.$('[g-name="'+a.slice(0,-4)+'"]').parent().addClass("g-active")},deactivateAll:function(){this.$(".g-global-nav-li").removeClass("g-active")}}),girder.views.LayoutHeaderUserView=girder.View.extend({events:{"click a.g-login":function(){girder.events.trigger("g:loginUi")},"click a.g-register":function(){girder.events.trigger("g:registerUi")},"click a.g-logout":function(){girder.restRequest({path:"user/authentication",type:"DELETE"}).done(_.bind(function(){girder.currentUser=null,girder.events.trigger("g:login")},this))},"click a.g-my-folders":function(){girder.router.navigate("user/"+girder.currentUser.get("_id"),{trigger:!0})},"click a.g-my-settings":function(){girder.router.navigate("useraccount/"+girder.currentUser.get("_id")+"/info",{trigger:!0})}},initialize:function(){girder.events.on("g:login",this.render,this)},render:function(){return this.$el.html(jade.templates.layoutHeaderUser({user:girder.currentUser})),this}}),girder.views.LayoutHeaderView=girder.View.extend({events:{"click .g-app-title":function(){girder.router.navigate("",{trigger:!0})}},render:function(){this.$el.html(jade.templates.layoutHeader()),new girder.views.LayoutHeaderUserView({el:this.$(".g-current-user-wrapper")}).render(),this.searchWidget=new girder.views.SearchFieldWidget({el:this.$(".g-quick-search-container"),placeholder:"Quick search...",types:["item","folder","group","collection","user"]}).off().on("g:resultClicked",function(a){this.searchWidget.resetState(),girder.router.navigate(a.type+"/"+a.id,{trigger:!0})},this).render()}}),girder.views.LoginView=girder.View.extend({events:{"submit #g-login-form":function(a){a.preventDefault();var b=window.btoa(this.$("#g-login").val()+":"+this.$("#g-password").val());girder.restRequest({path:"user/authentication",type:"GET",headers:{Authorization:"Basic "+b},error:null}).done(_.bind(function(a){this.$el.modal("hide"),a.user.token=a.authToken.token,girder.currentUser=new girder.models.UserModel(a.user),girder.dialogs.handleClose("login",{replace:!0}),girder.events.trigger("g:login")},this)).error(_.bind(function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("#g-login-button").removeClass("disabled")},this)),this.$("#g-login-button").addClass("disabled"),this.$(".g-validation-failed-message").text("")},"click a.g-register-link":function(){girder.events.trigger("g:registerUi")},"click a.g-forgot-password":function(){girder.events.trigger("g:resetPasswordUi")}},render:function(){var a=this;return this.$el.html(jade.templates.loginDialog()).girderModal(this).on("shown.bs.modal",function(){a.$("#g-login").focus()}).on("hidden.bs.modal",function(){girder.dialogs.handleClose("login",{replace:!0})}),girder.dialogs.handleOpen("login",{replace:!0}),this.$("#g-login").focus(),this}}),girder.views.ProgressListView=Backbone.View.extend({initialize:function(a){this.eventStream=a.eventStream,this.eventStream.on("g:event.progress",this._handleProgress,this),this._map={}},render:function(){return this.$el.html(jade.templates.layoutProgressArea()),this._onUpdate(),this},_handleProgress:function(a){if(_.has(this._map,a._id))this._map[a._id].update(a);else{var b=$("<div/>",{"class":"g-progress-widget-container"}).appendTo(this.$(".g-progress-list-container"));this._map[a._id]=new girder.views.TaskProgressWidget({el:b,progress:a}).on("g:hide",function(a){delete this._map[a._id],this._onUpdate()},this).render()}this._onUpdate()},_onUpdate:function(){_.isEmpty(this._map)?this.$el.hide():this.$el.show()}}),girder.views.RegisterView=girder.View.extend({events:{"submit #g-register-form":function(a){return a.preventDefault(),this.$(".form-group").removeClass("has-error"),this.$("#g-password").val()!==this.$("#g-password2").val()?(this.$("#g-group-password,#g-group-password2").addClass("has-error"),this.$("#g-password").focus(),void this.$(".g-validation-failed-message").text("Passwords must match.")):(girder.restRequest({path:"user",type:"POST",data:{login:this.$("#g-login").val(),password:this.$("#g-password").val(),email:this.$("#g-email").val(),firstName:this.$("#g-firstName").val(),lastName:this.$("#g-lastName").val()},error:null}).done(_.bind(function(a){this.$el.modal("hide"),girder.currentUser=new girder.models.UserModel(a),girder.dialogs.handleClose("register",{replace:!0}),girder.events.trigger("g:login")},this)).error(_.bind(function(a){var b=a.responseJSON;this.$(".g-validation-failed-message").text(b.message),b.field&&(this.$("#g-group-"+b.field).addClass("has-error"),this.$("#g-"+b.field).focus()),this.$("#g-register-button").removeClass("disabled")},this)),this.$("#g-register-button").addClass("disabled"),void this.$(".g-validation-failed-message").text(""))},"click a.g-login-link":function(){girder.events.trigger("g:loginUi")}},render:function(){var a=this;return this.$el.html(jade.templates.registerDialog()).girderModal(this).on("shown.bs.modal",function(){a.$("#g-login").focus()}).on("hidden.bs.modal",function(){girder.dialogs.handleClose("register",{replace:!0})}),this.$("#g-login").focus(),girder.dialogs.handleOpen("register",{replace:!0}),this}}),girder.views.ResetPasswordView=girder.View.extend({events:{"submit #g-reset-password-form":function(a){a.preventDefault(),girder.restRequest({path:"user/password?email="+this.$("#g-email").val().trim(),type:"DELETE",error:null}).done(_.bind(function(){this.$el.modal("hide"),girder.events.trigger("g:alert",{icon:"mail-alt",text:"Password reset email sent.",type:"success"})},this)).error(_.bind(function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("#g-login-button").removeClass("disabled")},this)),this.$("#g-login-button").addClass("disabled"),this.$(".g-validation-failed-message").text("")},"click a.g-register-link":function(){girder.events.trigger("g:registerUi")},"click a.g-login-link":function(){girder.events.trigger("g:loginUi")}},render:function(){var a=this;return this.$el.html(jade.templates.resetPasswordDialog()).girderModal(this).on("shown.bs.modal",function(){a.$("#g-email").focus()}),this.$("#g-email").focus(),this}}),girder.views.AccessWidget=girder.View.extend({events:{"click button.g-save-access-list":"saveAccessList","click a.g-action-remove-access":"removeAccessEntry","change .g-public-container .radio input":"privacyChanged"},initialize:function(a){this.model=a.model,this.modelType=a.modelType,this.model.get("access")?this.render():this.model.on("g:accessFetched",function(){this.render()},this).fetchAccess()},render:function(){var a;return"folder"===this.modelType?(girder.dialogs.handleOpen("folderaccess"),a=function(){girder.dialogs.handleClose("folderaccess")}):(girder.dialogs.handleOpen("access"),a=function(){girder.dialogs.handleClose("access")}),this.$el.html(jade.templates.accessEditor({model:this.model,modelType:this.modelType,"public":this.model.get("public")})).girderModal(this).on("hidden.bs.modal",a),_.each(this.model.get("access").groups,function(a){this.$("#g-ac-list-groups").append(jade.templates.accessEntry({accessTypes:girder.AccessType,type:"group",entry:_.extend(a,{title:a.name,subtitle:a.description})}))},this),_.each(this.model.get("access").users,function(a){this.$("#g-ac-list-users").append(jade.templates.accessEntry({accessTypes:girder.AccessType,type:"user",entry:_.extend(a,{title:a.name,subtitle:a.login})}))},this),this.$(".g-action-remove-access").tooltip({container:".modal",placement:"bottom",animation:!1,delay:{show:100}}),this.searchWidget=new girder.views.SearchFieldWidget({el:this.$(".g-search-field-container"),placeholder:"Start typing a name...",types:["group","user"]}).off().on("g:resultClicked",this.addEntry,this).render(),this.privacyChanged(),this},addEntry:function(a){this.searchWidget.resetState(),"user"===a.type?this._addUserEntry(a):"group"===a.type&&this._addGroupEntry(a)},_addUserEntry:function(a){var b=!1;if(_.every(this.model.get("access").users,function(c){return c.id===a.id&&(b=!0),!b},this),!b){var c=new girder.models.UserModel;c.set("_id",a.id).on("g:fetched",function(){this.$("#g-ac-list-users").append(jade.templates.accessEntry({accessTypes:girder.AccessType,type:"user",entry:{title:c.name(),subtitle:c.get("login"),id:a.id,level:girder.AccessType.READ}}))},this).fetch()}},_addGroupEntry:function(a){var b=!1;if(_.every(this.model.get("access").groups,function(c){return c.id===a.id&&(b=!0),!b},this),!b){var c=new girder.models.GroupModel;c.set("_id",a.id).on("g:fetched",function(){this.$("#g-ac-list-groups").append(jade.templates.accessEntry({accessTypes:girder.AccessType,type:"group",entry:{title:c.name(),subtitle:c.get("description"),id:a.id,level:girder.AccessType.READ}}))},this).fetch()}},saveAccessList:function(a){$(a.currentTarget).attr("disabled","disabled");var b={users:[],groups:[]};_.each(this.$(".g-group-access-entry"),function(a){var c=$(a);b.groups.push({name:c.find(".g-desc-title").html(),id:c.attr("resourceid"),level:parseInt(c.find(".g-access-col-right>select").val(),10)})},this),_.each(this.$(".g-user-access-entry"),function(a){var c=$(a);b.users.push({login:c.find(".g-desc-subtitle").html(),name:c.find(".g-desc-title").html(),id:c.attr("resourceid"),level:parseInt(c.find(".g-access-col-right>select").val(),10)})},this),this.model.set({access:b,"public":this.$("#g-access-public").is(":checked")}),this.model.off("g:accessListSaved").on("g:accessListSaved",function(){this.$el.modal("hide")},this).updateAccess()},removeAccessEntry:function(a){var b=".g-user-access-entry,.g-group-access-entry";$(a.currentTarget).tooltip("hide").parents(b).remove()},privacyChanged:function(){this.$(".g-public-container .radio").removeClass("g-selected");var a=this.$(".g-public-container .radio input:checked");a.parents(".radio").addClass("g-selected")}}),girder.views.CheckedMenuWidget=girder.View.extend({initialize:function(a){this.folderCount=a.folderCount||0,this.itemCount=a.itemCount||0,this.minFolderLevel=girder.AccessType.READ,this.minItemLevel=girder.AccessType.READ,this.dropdownToggle=a.dropdownToggle},render:function(){return this.folderCount+this.itemCount===0?void this.dropdownToggle.attr("disabled","disabled"):(this.dropdownToggle.removeAttr("disabled"),void this.$el.html(jade.templates.checkedActionsMenu({minFolderLevel:this.minFolderLevel,minItemLevel:this.minItemLevel,folderCount:this.folderCount,itemCount:this.itemCount,AccessType:girder.AccessType})))},update:function(a){this.minFolderLevel=a.minFolderLevel,this.minItemLevel=a.minItemLevel,this.folderCount=a.folderCount||0,this.itemCount=a.itemCount||0,this.render()}}),girder.views.EditAssetstoreWidget=girder.View.extend({events:{"submit #g-assetstore-edit-form":function(a){a.preventDefault();var b,c=this;c.model.get("type")===girder.AssetstoreType.FILESYSTEM?b={name:this.$("#g-edit-name").val(),root:this.$("#g-edit-fs-root").val()}:c.model.get("type")===girder.AssetstoreType.GRIDFS?b={name:this.$("#g-edit-name").val(),db:this.$("#g-edit-gridfs-db").val()}:c.model.get("type")===girder.AssetstoreType.S3&&(b={name:this.$("#g-edit-name").val(),bucket:this.$("#g-edit-s3-bucket").val(),prefix:this.$("#g-edit-s3-prefix").val(),accessKeyId:this.$("#g-edit-s3-access-key-id").val(),secret:this.$("#g-edit-s3-secret").val(),service:this.$("#g-edit-s3-service").val()}),this.updateAssetstore(b),this.$("button.g-save-assetstore").addClass("disabled"),this.$(".g-validation-failed-message").text("")}},initialize:function(a){this.model=a.model||null},render:function(){var a=this,b=this.$el.html(jade.templates.editAssetstoreWidget({assetstore:a.model,types:girder.AssetstoreType})).girderModal(this).on("shown.bs.modal",function(){a.$("#g-edit-name").focus(),girder.dialogs.handleOpen("assetstoreedit")}).on("hidden.bs.modal",function(){girder.dialogs.handleClose("assetstoreedit")}).on("ready.girder.modal",function(){a.$("#g-edit-name").val(a.model.get("name")),a.model.get("type")===girder.AssetstoreType.FILESYSTEM?a.$("#g-edit-fs-root").val(a.model.get("root")):a.model.get("type")===girder.AssetstoreType.GRIDFS?a.$("#g-edit-gridfs-db").val(a.model.get("db")):a.model.get("type")===girder.AssetstoreType.S3&&(a.$("#g-edit-s3-bucket").val(a.model.get("bucket")),a.$("#g-edit-s3-prefix").val(a.model.get("prefix")),a.$("#g-edit-s3-access-key-id").val(a.model.get("accessKeyId")),a.$("#g-edit-s3-secret").val(a.model.get("secret")),a.$("#g-edit-s3-service").val(a.model.get("service")))});return b.trigger($.Event("ready.girder.modal",{relatedTarget:b})),this},updateAssetstore:function(a){var b={},c=this.model;_.each(a,function(a,d){b[d]=c.get(d)}),this.model.set(a),this.model.on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",this.model)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-assetstore").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus(),this.model.set(b)},this).save()}}),girder.views.EditCollectionWidget=girder.View.extend({events:{"submit #g-collection-edit-form":function(a){a.preventDefault();var b={name:this.$("#g-name").val(),description:this.$("#g-description").val()};this.model?this.updateCollection(b):this.createCollection(b),this.$("button.g-save-collection").addClass("disabled"),this.$(".g-validation-failed-message").text("")}},initialize:function(a){this.model=a.model||null},render:function(){var a=this,b=this.$el.html(jade.templates.editCollectionWidget({collection:a.model})).girderModal(this).on("shown.bs.modal",function(){a.$("#g-name").focus()}).on("hidden.bs.modal",function(){girder.dialogs.handleClose(a.create?"create":"edit")}).on("ready.girder.modal",function(){a.model?(a.$("#g-name").val(a.model.get("name")),a.$("#g-description").val(a.model.get("description")),a.create=!1):a.create=!0});return b.trigger($.Event("ready.girder.modal",{relatedTarget:b})),this.$("#g-name").focus(),girder.dialogs.handleOpen(a.model?"edit":"create"),this},createCollection:function(a){var b=new girder.models.CollectionModel;b.set(a),b.on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",b)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-collection").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus()},this).save()},updateCollection:function(a){this.model.set(a),this.model.on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",this.model)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-collection").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus()},this).save()}}),girder.views.EditFileWidget=girder.View.extend({events:{"submit #g-file-edit-form":function(){var a={name:this.$("#g-name").val(),mimeType:this.$("#g-mimetype").val()};return this.file.set(a),this.file.off(null,null,this).on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",this.file)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-file").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus()},this).save(),this.$("button.g-save-file").addClass("disabled"),this.$(".g-validation-failed-message").empty(),!1}},initialize:function(a){this.file=a.file||null},render:function(){var a=this;return this.$el.html(jade.templates.editFileWidget({file:this.file})).girderModal(this).on("shown.bs.modal",function(){a.$("#g-name").select().focus()}),this}}),girder.views.EditFolderWidget=girder.View.extend({events:{"submit #g-folder-edit-form":function(a){a.preventDefault();var b={name:this.$("#g-name").val(),description:this.$("#g-description").val()};this.folder?this.updateFolder(b):this.createFolder(b),this.$("button.g-save-folder").addClass("disabled"),this.$(".g-validation-failed-message").text("")}},initialize:function(a){this.folder=a.folder||null,this.parentModel=a.parentModel},render:function(){var a=this,b=this.$el.html(jade.templates.editFolderWidget({folder:this.folder})).girderModal(this).on("shown.bs.modal",function(){a.$("#g-name").focus(),girder.dialogs.handleOpen(a.folder?"folderedit":"foldercreate")}).on("hidden.bs.modal",function(){girder.dialogs.handleClose(a.create?"foldercreate":"folderedit")}).on("ready.girder.modal",function(){a.folder?(a.$("#g-name").val(a.folder.get("name")),a.$("#g-description").val(a.folder.get("description")),a.create=!1):a.create=!0});return b.trigger($.Event("ready.girder.modal",{relatedTarget:b})),this.$("#g-name").focus(),this},createFolder:function(a){var b=new girder.models.FolderModel;b.set(_.extend(a,{parentType:this.parentModel.resourceName,parentId:this.parentModel.get("_id")})),b.on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",b)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-folder").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus()},this).save()},updateFolder:function(a){this.folder.set(a),this.folder.off().on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",this.folder)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-folder").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus()},this).save()}}),girder.views.EditGroupWidget=girder.View.extend({events:{"submit #g-group-edit-form":function(a){a.preventDefault();var b={name:this.$("#g-name").val(),description:this.$("#g-description").val(),"public":this.$("#g-access-public").is(":checked")};this.model?this.updateGroup(b):this.createGroup(b),this.$("button.g-save-group").addClass("disabled"),this.$(".g-validation-failed-message").text("")},"change .g-public-container .radio input":"privacyChanged"},initialize:function(a){this.model=a.model||null},render:function(){var a=this,b=this.model?this.model.get("public"):!1,c=this.$el.html(jade.templates.editGroupWidget({group:this.model,"public":b})).girderModal(this).on("shown.bs.modal",function(){a.$("#g-name").focus(),girder.dialogs.handleOpen(a.model?"edit":"create")}).on("hidden.bs.modal",function(){girder.dialogs.handleClose(a.create?"create":"edit")}).on("ready.girder.modal",function(){a.model?(a.$("#g-name").val(a.model.get("name")),a.$("#g-description").val(a.model.get("description")),a.create=!1):a.create=!0});return c.trigger($.Event("ready.girder.modal",{relatedTarget:c})),this.$("#g-name").focus(),this.privacyChanged(),this},createGroup:function(a){var b=new girder.models.GroupModel;b.set(a),b.on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",b)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-group").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus()},this).save()},updateGroup:function(a){this.model.set(a),this.model.off().on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",this.model)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-group").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus()},this).save()},privacyChanged:function(){this.$(".g-public-container .radio").removeClass("g-selected");var a=this.$(".g-public-container .radio input:checked");a.parents(".radio").addClass("g-selected")}}),girder.views.EditItemWidget=girder.View.extend({events:{"submit #g-item-edit-form":function(){var a={name:this.$("#g-name").val(),description:this.$("#g-description").val()};return this.item?this.updateItem(a):this.createItem(a),this.$("button.g-save-item").addClass("disabled"),this.$(".g-validation-failed-message").empty(),!1}},initialize:function(a){this.item=a.item||null,this.parentModel=a.parentModel},render:function(){var a=this,b=this.$el.html(jade.templates.editItemWidget({item:this.item})).girderModal(this).on("shown.bs.modal",function(){a.$("#g-name").focus(),girder.dialogs.handleOpen(a.item?"itemedit":"itemcreate")}).on("hidden.bs.modal",function(){girder.dialogs.handleClose(a.create?"itemcreate":"itemedit")}).on("ready.girder.modal",function(){a.item?(a.$("#g-name").val(a.item.get("name")),a.$("#g-description").val(a.item.get("description")),a.create=!1):a.create=!0
});return b.trigger($.Event("ready.girder.modal",{relatedTarget:b})),this},createItem:function(a){var b=new girder.models.ItemModel;b.set(_.extend(a,{folderId:this.parentModel.get("_id")})),b.on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",b)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-item").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus()},this).save()},updateItem:function(a){this.item.set(a),this.item.off().on("g:saved",function(){this.$el.modal("hide"),this.trigger("g:saved",this.item)},this).on("g:error",function(a){this.$(".g-validation-failed-message").text(a.responseJSON.message),this.$("button.g-save-item").removeClass("disabled"),this.$("#g-"+a.responseJSON.field).focus()},this).save()}}),girder.views.FileListWidget=girder.View.extend({events:{"click a.g-show-more-files":function(){this.collection.fetchNextPage()},"click a.g-file-list-link":function(a){var b=$(a.currentTarget).attr("cid");this.collection.get(b).download()},"click a.g-update-contents":function(a){var b=$(a.currentTarget).parent().attr("file-cid");new girder.views.UploadWidget({el:$("#g-dialog-container"),title:"Replace file contents",parent:this.collection.get(b),parentType:"file"}).on("g:uploadFinished",function(){girder.events.trigger("g:alert",{icon:"ok",text:"File contents updated.",type:"success",timeout:4e3})},this).render()},"click a.g-update-info":function(a){var b=$(a.currentTarget).parent().attr("file-cid");this.editFileWidget||(this.editFileWidget=new girder.views.EditFileWidget({el:$("#g-dialog-container"),file:this.collection.get(b)}).off("g:saved",null,this).on("g:saved",function(){this.render()},this)),this.editFileWidget.render()}},initialize:function(a){this.checked=[],this.collection=new girder.collections.FileCollection,this.collection.resourceName="item/"+a.itemId+"/files",this.collection.append=!0,this.collection.on("g:changed",function(){this.trigger("g:changed"),this.render()},this).fetch()},render:function(){return this.checked=[],this.$el.html(jade.templates.fileList({files:this.collection.models,hasMore:this.collection.hasNextPage(),girder:girder})),this.$(".g-file-actions-container a[title]").tooltip({container:"body",placement:"auto",delay:100}),this},insertFile:function(a){this.collection.add(a),this.trigger("g:changed"),this.render()}}),girder.views.FolderListWidget=girder.View.extend({events:{"click a.g-folder-list-link":function(a){var b=$(a.currentTarget).attr("g-folder-cid");this.trigger("g:folderClicked",this.collection.get(b))},"click a.g-show-more-folders":function(){this.collection.fetchNextPage()}},initialize:function(a){this.checked=[],new girder.views.LoadingAnimation({el:this.$el}).render(),this.collection=new girder.collections.FolderCollection,this.collection.append=!0,this.collection.on("g:changed",function(){this.render(),this.trigger("g:changed")},this).fetch({parentType:a.parentType||"folder",parentId:a.parentId})},render:function(){this.checked=[],this.$el.html(jade.templates.folderList({folders:this.collection.models,hasMore:this.collection.hasNextPage()}));var a=this;return this.$(".g-list-checkbox").unbind("change").change(function(){var b=$(this).attr("g-folder-cid");if(this.checked)a.checked.push(b);else{var c=a.checked.indexOf(b);-1!==c&&a.checked.splice(c,1)}a.trigger("g:checkboxesChanged")}),this},insertFolder:function(a){this.collection.add(a),this.trigger("g:changed"),this.render()},checkAll:function(a){this.$(".g-list-checkbox").prop("checked",a),this.checked=[],a&&_.each(this.collection.models,function(a){this.checked.push(a.cid)},this),this.trigger("g:checkboxesChanged")}}),girder.views.GroupAdminsWidget=girder.View.extend({events:{"click .g-group-admin-demote":function(a){var b=$(a.currentTarget).parents("li"),c=this;girder.confirm({text:"Are you sure you want to remove admin privileges from <b>"+_.escape(b.attr("username"))+"</b>?",escapedHtml:!0,confirmCallback:function(){c.trigger("g:demoteUser",b.attr("userid"))}})},"click a.g-member-name":function(a){girder.events.trigger("g:navigateTo",girder.views.UserView,{id:$(a.currentTarget).parents("li").attr("userid")})}},initialize:function(a){this.model=a.group,this.admins=a.admins},render:function(){return this.$el.html(jade.templates.groupAdminList({group:this.model,level:this.model.get("_accessLevel"),admins:this.admins,accessType:girder.AccessType})),this.$(".g-group-admin-demote").tooltip({container:"body",placement:"left",animation:!1,delay:{show:100}}),this}}),girder.views.GroupInvitesWidget=girder.View.extend({events:{"click .g-group-uninvite":function(a){var b=$(a.currentTarget).parents("li"),c=this;girder.confirm({text:"Are you sure you want to remove the invitation for <b>"+_.escape(b.attr("username"))+"</b>?",escapedHtml:!0,confirmCallback:function(){var a=c.collection.get(b.attr("cid"));c.group.off("g:removed").on("g:removed",function(){c.collection.remove(a),c.render()}).removeMember(a.get("_id"))}})},"click a.g-member-name":function(a){var b=this.collection.get($(a.currentTarget).parents("li").attr("cid"));girder.router.navigate("user/"+b.get("_id"),{trigger:!0})}},initialize:function(a){this.collection=a.invitees,this.group=a.group},render:function(){return this.$el.html(jade.templates.groupInviteList({level:this.group.get("_accessLevel"),invitees:this.collection.models,accessType:girder.AccessType})),this.$("a[title]").tooltip({container:this.$el,placement:"left",animation:!1,delay:{show:100}}),this}}),girder.views.GroupMembersWidget=girder.View.extend({events:{"click a.g-member-name":function(a){var b=this.membersColl.get($(a.currentTarget).parents("li").attr("cid"));girder.router.navigate("user/"+b.get("_id"),{trigger:!0})},"click a.g-group-member-remove":function(a){var b=this,c=this.membersColl.get($(a.currentTarget).parents("li").attr("cid"));girder.confirm({text:"Are you sure you want to remove <b> "+_.escape(c.name())+"</b> from this group?",escapedHtml:!0,confirmCallback:function(){b.trigger("g:removeMember",c)}})},"click .g-promote-moderator":function(a){var b=$(a.currentTarget).parents(".g-group-members>li").attr("cid"),c=this.membersColl.get(b);this.model.off("g:promoted").on("g:promoted",function(){this.trigger("g:moderatorAdded")},this).promoteUser(c,girder.AccessType.WRITE)},"click .g-promote-admin":function(a){var b=$(a.currentTarget).parents(".g-group-members>li").attr("cid"),c=this.membersColl.get(b);this.model.off("g:promoted").on("g:promoted",function(){this.trigger("g:adminAdded")},this).promoteUser(c,girder.AccessType.ADMIN)}},initialize:function(a){this.model=a.group,this.membersColl=new girder.collections.UserCollection,this.membersColl.altUrl="group/"+this.model.get("_id")+"/member",this.membersColl.on("g:changed",function(){this.render()},this).fetch()},render:function(){return this.$el.html(jade.templates.groupMemberList({group:this.model,members:this.membersColl.models,level:this.model.get("_accessLevel"),accessType:girder.AccessType})),new girder.views.PaginateWidget({el:this.$(".g-member-pagination"),collection:this.membersColl}).render(),this.userSearch=new girder.views.SearchFieldWidget({el:this.$(".g-group-invite-container"),placeholder:"Invite a user to join...",types:["user"]}).off().on("g:resultClicked",this._inviteUser,this).render(),this.$(".g-group-member-remove,.g-group-member-promote").tooltip({container:"body",placement:"left",animation:!1,delay:{show:100}}),this},_inviteUser:function(a){this.userSearch.resetState(),new girder.views.InviteUserDialog({el:$("#g-dialog-container"),group:this.model,user:a}).on("g:sendInvite",function(a){this.trigger("g:sendInvite",a)},this).render()}}),girder.views.InviteUserDialog=girder.View.extend({events:{"click .g-invite-as-member":function(){this.$el.modal("hide"),this.trigger("g:sendInvite",{user:this.user,group:this.group,level:girder.AccessType.READ})},"click .g-invite-as-moderator":function(){this.$el.modal("hide"),this.trigger("g:sendInvite",{user:this.user,group:this.group,level:girder.AccessType.WRITE})},"click .g-invite-as-admin":function(){this.$el.modal("hide"),this.trigger("g:sendInvite",{user:this.user,group:this.group,level:girder.AccessType.ADMIN})}},initialize:function(a){this.group=a.group,this.user=a.user},render:function(){return this.$el.html(jade.templates.groupInviteDialog({group:this.group,user:this.user,level:this.group.get("_accessLevel"),accessType:girder.AccessType})).girderModal(this),this}}),girder.views.GroupModsWidget=girder.View.extend({events:{"click .g-group-mod-demote":function(a){var b=$(a.currentTarget).parents("li"),c=this;girder.confirm({text:"Are you sure you want to remove moderator privileges from <b>"+_.escape(b.attr("username"))+"</b>?",escapedHtml:!0,confirmCallback:function(){c.trigger("g:demoteUser",b.attr("userid"))}})},"click a.g-member-name":function(a){girder.events.trigger("g:navigateTo",girder.views.UserView,{id:$(a.currentTarget).parents("li").attr("userid")})}},initialize:function(a){this.model=a.group,this.moderators=a.moderators},render:function(){return this.$el.html(jade.templates.groupModList({group:this.model,level:this.model.get("_accessLevel"),moderators:this.moderators,accessType:girder.AccessType})),this.$(".g-group-mod-demote").tooltip({container:"body",placement:"left",animation:!1,delay:{show:100}}),this}}),girder.views.HierarchyWidget=girder.View.extend({events:{"click a.g-create-subfolder":"createFolderDialog","click a.g-edit-folder":"editFolderDialog","click a.g-download-folder":"downloadFolder","click a.g-delete-folder":"deleteFolderDialog","click a.g-create-item":"createItemDialog","click .g-upload-here-button":"uploadDialog","click .g-folder-access-button":"editFolderAccess","click .g-hierarchy-level-up":"upOneLevel","click a.g-download-checked":"downloadChecked","click a.g-delete-checked":"deleteCheckedDialog"},_childCountCheck:function(){var a=this.$(".g-empty-parent-message").addClass("hide");0===this.folderCount&&0===this.itemCount&&a.removeClass("hide")},initialize:function(a){this.parentModel=a.parentModel,this.upload=a.upload,this.folderAccess=a.folderAccess,this.folderCreate=a.folderCreate,this.folderEdit=a.folderEdit,this.itemCreate=a.itemCreate,this.breadcrumbs=[this.parentModel],"folder"===this.parentModel.resourceName?this._fetchToRoot(this.parentModel):this.render()},_setRoute:function(){var a=this.breadcrumbs[0].resourceName+"/"+this.breadcrumbs[0].get("_id");"folder"===this.parentModel.resourceName&&(a+="/folder/"+this.parentModel.get("_id")),girder.router.navigate(a),girder.events.trigger("g:hierarchy.route",{route:a})},_fetchToRoot:function(a){var b=a.get("parentId"),c=a.get("parentCollection"),d=new(girder.models[girder.getModelClassByName(c)]);d.set({_id:b}).on("g:fetched",function(){this.breadcrumbs.push(d),"folder"===c?this._fetchToRoot(d):(this.breadcrumbs.reverse(),this.render())},this).fetch()},render:function(){this.folderCount=null,this.itemCount=null,this.$el.html(jade.templates.hierarchyWidget({type:this.parentModel.resourceName,model:this.parentModel,level:this.parentModel.getAccessLevel(),AccessType:girder.AccessType}));var a=this;return this.$(".g-select-all").unbind("change").change(function(){a.folderListView.checkAll(this.checked),a.itemListView&&a.itemListView.checkAll(this.checked)}),0===this.$(".g-folder-actions-menu>li>a").length&&this.$(".g-folder-actions-button").attr("disabled","disabled"),this.breadcrumbView=new girder.views.HierarchyBreadcrumbView({el:this.$(".g-hierarchy-breadcrumb-bar>ol"),objects:this.breadcrumbs}),this.breadcrumbView.on("g:breadcrumbClicked",function(a){this.parentModel=this.breadcrumbs[a],this.breadcrumbs=this.breadcrumbs.slice(0,a+1),this.render(),this._setRoute()},this),this.checkedMenuWidget=new girder.views.CheckedMenuWidget({el:this.$(".g-checked-actions-menu"),dropdownToggle:this.$(".g-checked-actions-button")}),this.folderListView=new girder.views.FolderListWidget({parentType:this.parentModel.resourceName,parentId:this.parentModel.get("_id"),el:this.$(".g-folder-list-container")}),this.folderListView.on("g:folderClicked",function(a){this.descend(a),this.uploadWidget&&(this.uploadWidget.folder=a)},this).off("g:checkboxesChanged").on("g:checkboxesChanged",this.updateChecked,this).off("g:changed").on("g:changed",function(){this.folderCount=this.folderListView.collection.length,this._childCountCheck()},this),"folder"===this.parentModel.resourceName?(this.itemListView=new girder.views.ItemListWidget({folderId:this.parentModel.get("_id"),el:this.$(".g-item-list-container")}),this.itemListView.on("g:itemClicked",function(a){girder.router.navigate("item/"+a.get("_id"),{trigger:!0})},this).off("g:checkboxesChanged").on("g:checkboxesChanged",this.updateChecked,this).off("g:changed").on("g:changed",function(){this.itemCount=this.itemListView.collection.length,this._childCountCheck()},this),this.metadataWidget=new girder.views.MetadataWidget({el:this.$(".g-folder-metadata"),item:this.parentModel,accessLevel:this.parentModel.getAccessLevel(),girder:girder})):this.itemCount=0,this.$(".g-folder-info-button,.g-folder-access-button,.g-select-all,.g-upload-here-button,.g-checked-actions-button").tooltip({container:this.$el,animation:!1,delay:{show:100}}),this.$(".g-folder-actions-button,.g-hierarchy-level-up").tooltip({container:this.$el,placement:"left",animation:!1,delay:{show:100}}),this.upload?this.uploadDialog():this.folderAccess?this.editFolderAccess():this.folderCreate?this.createFolderDialog():this.folderEdit?this.editFolderDialog():this.itemCreate&&this.createItemDialog(),this},descend:function(a){this.breadcrumbs.push(a),this.parentModel=a,this.render(),this._setRoute()},upOneLevel:function(){this.breadcrumbs.pop(),this.parentModel=this.breadcrumbs[this.breadcrumbs.length-1],this.render(),this._setRoute()},createFolderDialog:function(){new girder.views.EditFolderWidget({el:$("#g-dialog-container"),parentModel:this.parentModel}).on("g:saved",function(a){this.folderListView.insertFolder(a),this.updateChecked()},this).render()},createItemDialog:function(){new girder.views.EditItemWidget({el:$("#g-dialog-container"),parentModel:this.parentModel}).on("g:saved",function(a){this.itemListView.insertItem(a),this.updateChecked()},this).render()},editFolderDialog:function(){new girder.views.EditFolderWidget({el:$("#g-dialog-container"),parentModel:this.parentModel,folder:this.parentModel}).on("g:saved",function(){girder.events.trigger("g:alert",{icon:"ok",text:"Folder info updated.",type:"success",timeout:4e3}),this.breadcrumbView.render()},this).render()},deleteFolderDialog:function(){var a=this,b={text:"Are you sure you want to delete the folder <b>"+this.parentModel.escape("name")+"</b>?",escapedHtml:!0,yesText:"Delete",confirmCallback:function(){a.parentModel.destroy({throwError:!0,progress:!0}).on("g:deleted",function(){this.breadcrumbs.pop(),this.parentModel=this.breadcrumbs.slice(-1)[0],this.render(),this._setRoute()},a)}};girder.confirm(b)},deleteCheckedDialog:function(){var a=this,b="",c=this.folderListView.checked;if(1===c.length?b+="1 folder":c.length>1&&(b+=c.length+" folders"),this.itemListView&&this.itemListView.checked.length){""!==b&&(b+=" and ");var d=this.itemListView.checked;b+=1===d.length?"1 item":d.length+" items"}var e={text:"Are you sure you want to delete the checked items ("+b+")?",yesText:"Delete",confirmCallback:function(){var b="resource?"+a._getCheckedResourceParam();girder.restRequest({path:b,type:"DELETE"}).done(function(){a.render()})}};girder.confirm(e)},uploadDialog:function(){var a=$("#g-dialog-container");new girder.views.UploadWidget({el:a,parent:this.parentModel,parentType:this.parentType}).on("g:uploadFinished",function(){girder.dialogs.handleClose("upload"),this.upload=!1,this.render()},this).render()},updateChecked:function(){var a=this.folderListView.checked,b=[],c=girder.AccessType.ADMIN;_.every(a,function(a){var b=this.folderListView.collection.get(a);return c=Math.min(c,b.getAccessLevel()),c>girder.AccessType.READ},this);var d=girder.AccessType.ADMIN;this.itemListView&&(b=this.itemListView.checked,b.length&&(d=Math.min(d,this.parentModel.getAccessLevel()))),this.checkedMenuWidget.update({minFolderLevel:c,minItemLevel:d,folderCount:a.length,itemCount:b.length})},downloadFolder:function(){this.parentModel.download()},_getCheckedResourceParam:function(){var a={folder:[],item:[]},b=this.folderListView.checked;if(_.each(b,function(b){var c=this.folderListView.collection.get(b);a.folder.push(c.id)},this),this.itemListView){var c=this.itemListView.checked;_.each(c,function(b){var c=this.itemListView.collection.get(b);return a.item.push(c.id),!0},this)}return"resources="+window.encodeURIComponent(JSON.stringify(a))},downloadChecked:function(){var a=girder.apiRoot+"/resource/download";a+="?"+this._getCheckedResourceParam();var b=girder.cookie.find("girderToken");b&&(a+="&token="+b),window.location.assign(a)},editFolderAccess:function(){new girder.views.AccessWidget({el:$("#g-dialog-container"),modelType:this.parentModel.resourceName,model:this.parentModel}).on("g:saved",function(){},this)}}),girder.views.HierarchyBreadcrumbView=girder.View.extend({events:{"click a.g-breadcrumb-link":function(a){var b=$(a.currentTarget);this.trigger("g:breadcrumbClicked",parseInt(b.attr("g-index"),10))}},initialize:function(a){this.objects=a.objects,this.render()},render:function(){var a=this.objects.slice(0),b=a.pop();this.$el.html(jade.templates.hierarchyBreadcrumb({links:a,current:b}))}}),girder.views.ItemBreadcrumbWidget=girder.View.extend({events:{"click a.g-item-breadcrumb-link":function(a){var b=$(a.currentTarget);girder.router.navigate(b.data("type")+"/"+b.data("id"),{trigger:!0})},"click a.g-hierarchy-level-up":function(){var a=this.parentChain.pop().object;girder.router.navigate("folder/"+a._id,{trigger:!0})}},initialize:function(a){this.parentChain=a.parentChain,this.render()},render:function(){this.$el.html(jade.templates.itemBreadcrumb({parentChain:this.parentChain})),this.$(".g-hierarchy-level-up").tooltip({container:this.$el,placement:"left",animation:!1,delay:{show:100}})}}),girder.views.ItemListWidget=girder.View.extend({events:{"click a.g-item-list-link":function(a){var b=$(a.currentTarget).attr("g-item-cid");this.trigger("g:itemClicked",this.collection.get(b))},"click a.g-show-more-items":function(){this.collection.fetchNextPage()}},initialize:function(a){this.checked=[],new girder.views.LoadingAnimation({el:this.$el}).render(),this.collection=new girder.collections.ItemCollection,this.collection.append=!0,this.collection.on("g:changed",function(){this.trigger("g:changed"),this.render()},this).fetch({folderId:a.folderId})},render:function(){this.checked=[],this.$el.html(jade.templates.itemList({items:this.collection.models,hasMore:this.collection.hasNextPage(),girder:girder}));var a=this;return this.$(".g-list-checkbox").unbind("change").change(function(){var b=$(this).attr("g-item-cid");if(this.checked)a.checked.push(b);else{var c=a.checked.indexOf(b);-1!==c&&a.checked.splice(c,1)}a.trigger("g:checkboxesChanged")}),this},insertItem:function(a){this.collection.add(a),this.trigger("g:changed"),this.render()},checkAll:function(a){this.$(".g-list-checkbox").prop("checked",a),this.checked=[],a&&_.each(this.collection.models,function(a){this.checked.push(a.cid)},this),this.trigger("g:checkboxesChanged")}}),girder.views.LoadingAnimation=girder.View.extend({render:function(){return this.$el.html(jade.templates.loadingAnimation()),this}}),girder.views.MetadataWidget=girder.View.extend({events:{"click .g-widget-metadata-add-button":"addMetadata","click .g-widget-metadata-edit-button":"editMetadata"},addMetadata:function(){var a=$("<div>").attr({"class":"g-widget-metadata-row editing"}).appendTo(this.$el.find(".g-widget-metadata-container"));this.metadatumEditWidget=new girder.views.MetadatumEditWidget({el:a,item:this.item,key:"",value:"",newDatum:!0,accessLevel:this.accessLevel,girder:girder})},editMetadata:function(a){var b=$(a.currentTarget.parentElement);b.addClass("editing").empty(),this.metadatumEditWidget=new girder.views.MetadatumEditWidget({el:b,item:this.item,key:b.attr("g-key"),value:b.attr("g-value"),accessLevel:this.accessLevel,newDatum:!1,girder:girder})},initialize:function(a){this.item=a.item,this.accessLevel=a.accessLevel,this.item.on("g:changed",function(){this.render()},this),this.render()},render:function(){var a=this.item.attributes.meta||{},b=Object.keys(a);b.sort(girder.localeSort);for(var c=[],d=0;d<b.length;d+=1){var e=a[b[d]];"object"==typeof e&&(e=JSON.stringify(e)),c.push({key:b[d],value:e})}return this.$el.html(jade.templates.metadataWidget({item:this.item,meta:c,accessLevel:this.accessLevel,girder:girder})),this.$(".g-widget-metadata-add-button").tooltip({container:this.$el,placement:"left",animation:!1,delay:{show:100}}),this}}),girder.views.MetadatumEditWidget=girder.View.extend({events:{"click .g-widget-metadata-cancel-button":"cancelEdit","click .g-widget-metadata-save-button":"save","click .g-widget-metadata-delete-button":"deleteMetadatum"},deleteMetadatum:function(a){a.stopImmediatePropagation();var b=$(a.currentTarget.parentElement),c={text:"Are you sure you want to delete the metadatum <b>"+_.escape(this.key)+"</b>?",escapedHtml:!0,yesText:"Delete",confirmCallback:_.bind(function(){this.item.removeMetadata(this.key,function(){b.remove()})},this)};girder.confirm(c)},cancelEdit:function(a){a.stopImmediatePropagation();var b=$(a.currentTarget.parentElement);this.newDatum?b.remove():b.removeClass("editing").html(jade.templates.metadatumView({key:this.key,value:this.value,accessLevel:this.accessLevel,girder:girder}))},save:function(a){a.stopImmediatePropagation();var b=$(a.currentTarget.parentElement),c=b.find(".g-widget-metadata-key-input").val(),d=b.find(".g-widget-metadata-value-input").val();if(this.newDatum&&""===c)return void girder.events.trigger("g:alert",{text:"A key is required for all metadata.",type:"warning"});var e=d;try{var f=JSON.parse(d);f&&"object"==typeof f&&null!==f&&(d=f)}catch(g){}var h=_.bind(function(){this.key=c,this.value=e,b.removeClass("editing").attr({"g-key":this.key,"g-value":this.value}).html(jade.templates.metadatumView({key:this.key,value:this.value,accessLevel:this.accessLevel,girder:girder})),this.newDatum=!1},this),i=function(a){girder.events.trigger("g:alert",{text:a.message,type:"danger"})};this.newDatum?this.item.addMetadata(c,d,h,i):this.item.editMetadata(c,this.key,d,h,i)},initialize:function(a){this.item=a.item,this.key=a.key||"",this.value=a.value||"",this.accessLevel=a.accessLevel,this.newDatum=a.newDatum,this.render()},render:function(){return this.$el.html(jade.templates.metadatumEditWidget({item:this.item,key:this.key,value:this.value,accessLevel:this.accessLevel,newDatum:this.newDatum,girder:girder})),this.$el.find(".g-widget-metadata-key-input").focus(),this.$("[title]").tooltip({container:this.$el,placement:"bottom",animation:!1,delay:{show:100}}),this}}),girder.views.NewAssetstoreWidget=girder.View.extend({events:{"submit #g-new-fs-form":function(a){this.createAssetstore(a,this.$("#g-new-fs-error"),{type:girder.AssetstoreType.FILESYSTEM,name:this.$("#g-new-fs-name").val(),root:this.$("#g-new-fs-root").val()})},"submit #g-new-gridfs-form":function(a){this.createAssetstore(a,this.$("#g-new-gridfs-error"),{type:girder.AssetstoreType.GRIDFS,name:this.$("#g-new-gridfs-name").val(),db:this.$("#g-new-gridfs-db").val()})},"submit #g-new-s3-form":function(a){this.createAssetstore(a,this.$("#g-new-s3-error"),{type:girder.AssetstoreType.S3,name:this.$("#g-new-s3-name").val(),bucket:this.$("#g-new-s3-bucket").val(),prefix:this.$("#g-new-s3-prefix").val(),accessKeyId:this.$("#g-new-s3-access-key-id").val(),secret:this.$("#g-new-s3-secret").val(),service:this.$("#g-new-s3-service").val()})}},render:function(){return this.$el.html(jade.templates.newAssetstore()),this},createAssetstore:function(a,b,c){a.preventDefault(),this.$(".g-new-assetstore-submit").addClass("disabled"),b.empty();var d=new girder.models.AssetstoreModel;d.set(c),d.on("g:saved",function(){this.$(".g-new-assetstore-submit").removeClass("disabled"),this.trigger("g:created",d)},this).on("g:error",function(a){this.$(".g-new-assetstore-submit").removeClass("disabled"),b.text(a.responseJSON.message)},this).save()}}),girder.views.PaginateWidget=girder.View.extend({events:{"click .g-page-next":function(a){$(a.currentTarget).hasClass("disabled")||this.collection.fetchNextPage()},"click .g-page-prev":function(a){$(a.currentTarget).hasClass("disabled")||this.collection.fetchPreviousPage()}},initialize:function(a){this.collection=a.collection},render:function(){return this.$el.html(jade.templates.paginateWidget({collection:this.collection})),this.collection.hasNextPage()?this.$(".g-page-next").removeClass("disabled"):this.$(".g-page-next").addClass("disabled"),this.collection.hasPreviousPage()?this.$(".g-page-prev").removeClass("disabled"):this.$(".g-page-prev").addClass("disabled"),this}}),girder.views.PluginConfigBreadcrumbWidget=girder.View.extend({events:{"click a.g-admin-console-link":function(){girder.router.navigate("admin",{trigger:!0})},"click a.g-plugins-link":function(){girder.router.navigate("plugins",{trigger:!0})}},initialize:function(a){this.pluginName=a.pluginName},render:function(){return this.$el.html(jade.templates.pluginConfigBreadcrumb({pluginName:this.pluginName})),this}}),girder.views.SearchFieldWidget=girder.View.extend({events:{"input .g-search-field":function(){var a=this.$(".g-search-field").val();return a?void(this.ajaxLock?this.pending=a:this._doSearch(a)):void this.hideResults()},"click .g-search-result>a":function(a){var b=$(a.currentTarget);this.trigger("g:resultClicked",{type:b.attr("resourcetype"),id:b.attr("resourceid"),text:b.text()})}},initialize:function(a){this.ajaxLock=!1,this.pending=null,this.placeholder=a.placeholder||"Search...",this.types=a.types||[]},render:function(){return this.$el.html(jade.templates.searchField({placeholder:this.placeholder})),this.$("[title]").tooltip({placement:"auto"}),this.$(".g-search-options-button").popover({trigger:"manual",placement:"bottom",html:!0,content:jade.templates.searchHelp()}).blur(function(){$(this).popover("hide")}).click(function(){$(this).popover("toggle")}),this},hideResults:function(){return this.$(".dropdown").removeClass("open"),this},clearText:function(){return this.$(".g-search-field").val(""),this},resetState:function(){return this.hideResults().clearText()},_doSearch:function(a){this.ajaxLock=!0,this.pending=null,girder.restRequest({path:"resource/search",data:{q:a,types:JSON.stringify(this.types)}}).done(_.bind(function(a){if(this.ajaxLock=!1,this.pending)this._doSearch(this.pending);else{var b=this.$(".g-search-results>ul"),c=[];_.each(this.types,function(b){_.each(a[b]||[],function(a){var d,e;"user"===b?(d=a.firstName+" "+a.lastName+" ("+a.login+")",e="user"):"group"===b?(d=a.name,e="users"):"collection"===b?(d=a.name,e="sitemap"):"folder"===b?(d=a.name,e="folder"):"item"===b?(d=a.name,e="doc-text-inv"):(d="[unknown type]",e="attention"),c.push({type:b,id:a._id,text:d,icon:e})},this)},this),b.html(jade.templates.searchResults({results:c})),this.$(".dropdown").addClass("open")}},this))}}),girder.views.TaskProgressWidget=Backbone.View.extend({initialize:function(a){this.progress=a.progress},render:function(){var a="0",b=[],c=[];return"active"===this.progress.data.state?this.progress.data.total<=0?(a="100%",b.push("progress-bar-warning"),c.push("progress-striped","active")):a=Math.round(100*this.progress.data.current/this.progress.data.total)+"%":"success"===this.progress.data.state?(a="100%",b.push("progress-bar-success"),this._scheduleHide(5e3)):"error"===this.progress.data.state&&(a="100%",b.push("progress-bar-danger"),this._scheduleHide(1e4)),this.$el.html(jade.templates.taskProgress({progress:this.progress,width:a,barClass:b.join(" "),progressClass:c.join(" ")})),this},update:function(a){this.progress=a,this.render()},_scheduleHide:function(a){var b=this;window.setTimeout(function(){b.$el.fadeOut(500,function(){b.remove(),b.trigger("g:hide",b.progress)})},a)}}),girder.views.UploadWidget=girder.View.extend({events:{"submit #g-upload-form":"startUpload","click .g-resume-upload":function(){this.$(".g-upload-error-message").html(""),this.currentFile.resumeUpload()},"click .g-restart-upload":function(){this.$(".g-upload-error-message").html(""),this._uploadNextFile()},"change #g-files":function(){var a=this.$("#g-files")[0].files;a.length&&(this.files=a,this.filesChanged())},"click .g-drop-zone":function(){this.$("#g-files").click()},"dragenter .g-drop-zone":function(a){a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="copy",this.$(".g-drop-zone").addClass("g-dropzone-show").html('<i class="icon-bullseye"/> Drop files here')},"dragleave .g-drop-zone":function(a){a.stopPropagation(),a.preventDefault(),this.$(".g-drop-zone").removeClass("g-dropzone-show").html('<i class="icon-docs"/> Browse or drop files')},"dragover .g-drop-zone":function(a){a.preventDefault()},"drop .g-drop-zone":"filesDropped"},initialize:function(a){this.parent=a.parent||a.folder,this.parentType=a.parentType||"folder",this.title=a.title||"Upload files",this.files=[],this.totalSize=0},render:function(){var a=this;return this.$el.html(jade.templates.uploadWidget({parent:this.parent,parentType:this.parentType,title:this.title})).girderModal(this).on("hidden.bs.modal",function(){$(".g-resume-upload").length&&a.currentFile&&a.currentFile.abortUpload(),girder.dialogs.handleClose("upload")}),girder.dialogs.handleOpen("upload"),this},filesDropped:function(a){a.stopPropagation(),a.preventDefault(),this.$(".g-drop-zone").removeClass("g-dropzone-show").html('<i class="icon-docs"/> Browse or drop files'),this.files=a.originalEvent.dataTransfer.files,this.filesChanged()},filesChanged:function(){if(0===this.files.length)this.$(".g-overall-progress-message").text("No files selected"),this.$(".g-start-upload").addClass("disabled");else{this.totalSize=0,_.each(this.files,function(a){this.totalSize+=a.size},this);var a;a=this.files.length>1?"Selected "+this.files.length+" files":"Selected <b>"+this.files[0].name+"</b>",this.$(".g-overall-progress-message").html('<i class="icon-ok"/> '+a+"  ("+girder.formatSize(this.totalSize)+") -- Press start button"),this.$(".g-start-upload").removeClass("disabled"),this.$(".g-progress-overall,.g-progress-current").addClass("hide"),this.$(".g-current-progress-message").empty(),this.$(".g-upload-error-message").empty()}},startUpload:function(a){a.preventDefault(),this.$(".g-drop-zone").addClass("hide"),this.$(".g-start-upload").addClass("disabled"),this.$(".g-progress-overall,.g-progress-current").removeClass("hide"),this.$(".g-upload-error-message").empty(),this.currentIndex=0,this.overallProgress=0,this._uploadNextFile()},_uploadNextFile:function(){return this.currentIndex>=this.files.length?(this.$el.modal("hide"),void this.trigger("g:uploadFinished")):(this.currentFile="file"===this.parentType?this.parent:new girder.models.FileModel,this.currentFile.on("g:upload.complete",function(){this.currentIndex+=1,this._uploadNextFile()},this).on("g:upload.chunkSent",function(a){this.overallProgress+=a.bytes},this).on("g:upload.progress",function(a){var b=a.startByte+a.loaded;this.$(".g-progress-current>.progress-bar").css("width",Math.ceil(100*b/a.total)+"%"),this.$(".g-progress-overall>.progress-bar").css("width",Math.ceil(100*(this.overallProgress+a.loaded)/this.totalSize)+"%"),this.$(".g-current-progress-message").html('<i class="icon-doc-text"/>'+(this.currentIndex+1)+" of "+this.files.length+" - <b>"+a.file.name+"</b>: "+girder.formatSize(b)+" / "+girder.formatSize(a.total)),this.$(".g-overall-progress-message").html("Overall progress: "+girder.formatSize(this.overallProgress+a.loaded)+" / "+girder.formatSize(this.totalSize))},this).on("g:upload.error",function(a){var b=a.message+' <a class="g-resume-upload">Click to resume upload</a>';$(".g-upload-error-message").html(b)},this).on("g:upload.errorStarting",function(a){var b=a.message+' <a class="g-restart-upload">Click to restart upload</a>';
$(".g-upload-error-message").html(b)},this),void("file"===this.parentType?this.currentFile.updateContents(this.files[this.currentIndex]):this.currentFile.upload(this.parent,this.files[this.currentIndex])))}});
//# sourceMappingURL=app.min.map